<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>n8n×GitHub Webhook 疎通（詰まりポイント込み）</title>
</head>
<body>
<!-- 20251221 -->
<h1>n8n×GitHub Webhook 疎通（詰まりポイント込み）</h1>

<!doctype html>

<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>n8n×GitHub Webhook 疎通（詰まりポイント込み）</title>
  <style>
    /* --- Mobile-first, simple and robust --- */
    :root{
      --bg:#0b1020;
      --card:#121a33;
      --card2:#0f1730;
      --text:#eef2ff;
      --muted:#b7c0ff;
      --line:#2a3560;
      --accent:#7aa2ff;
      --ok:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", Arial, sans-serif;
    }

```
html, body { height: 100%; }
body {
  margin: 0;
  background: radial-gradient(1200px 800px at 10% 0%, #121a33 0%, var(--bg) 55%, #070a14 100%);
  color: var(--text);
  font-family: var(--sans);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

a { color: var(--accent); text-decoration: none; }
a:hover { text-decoration: underline; }

.wrap {
  max-width: 980px;
  margin: 0 auto;
  padding: 14px 12px 60px;
}

header {
  padding: 6px 0 10px;
}

h1 {
  font-size: 20px;
  line-height: 1.35;
  margin: 10px 0 6px;
}

.sub {
  margin: 0 0 10px;
  color: var(--muted);
  font-size: 13px;
  line-height: 1.65;
}

.callout {
  border: 1px solid var(--line);
  background: rgba(18,26,51,.65);
  border-radius: 12px;
  padding: 10px 12px;
  margin: 10px 0 12px;
}

.callout b { color: var(--text); }

/* Toolbar */
.toolbar {
  position: sticky;
  top: 0;
  z-index: 10;
  border: 1px solid var(--line);
  background: rgba(11,16,32,.92);
  backdrop-filter: blur(8px);
  border-radius: 12px;
  padding: 10px;
  margin: 10px 0 14px;
}

.toolbar .row {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center;
  justify-content: space-between;
}

.btns {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

button {
  border: 1px solid var(--line);
  background: rgba(18,26,51,.95);
  color: var(--text);
  padding: 10px 11px;
  border-radius: 10px;
  font-size: 13px;
  cursor: pointer;
}

button:active { transform: translateY(1px); }
button:hover { border-color: #3b4f93; }

.hint {
  color: var(--muted);
  font-size: 12px;
  line-height: 1.5;
}

/* TOC */
.toc {
  border: 1px solid var(--line);
  background: rgba(18,26,51,.55);
  border-radius: 12px;
  padding: 10px 12px;
  margin: 0 0 14px;
}

.toc h2 {
  font-size: 14px;
  margin: 0 0 8px;
}

.toc ol {
  margin: 0;
  padding-left: 18px;
}

.toc li { margin: 6px 0; }

/* Details sections */
details {
  border: 1px solid var(--line);
  background: rgba(18,26,51,.55);
  border-radius: 14px;
  margin: 10px 0;
  overflow: hidden;
}

summary {
  cursor: pointer;
  padding: 12px 12px 12px 14px;
  list-style: none;
}

summary::-webkit-details-marker { display:none; }

.sumline {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  align-items: flex-start;
}

.tag {
  display: inline-block;
  font-size: 11px;
  padding: 3px 9px;
  border-radius: 999px;
  border: 1px solid var(--line);
  color: var(--muted);
  line-height: 1.2;
  margin-top: 1px;
  white-space: nowrap;
}

.tag.ok { border-color: rgba(52,211,153,.45); color: var(--ok); }
.tag.warn { border-color: rgba(251,191,36,.45); color: var(--warn); }
.tag.bad { border-color: rgba(251,113,133,.45); color: var(--bad); }

.title {
  font-weight: 700;
  font-size: 14px;
  line-height: 1.35;
  margin: 0;
}

.meta {
  margin: 2px 0 0;
  color: var(--muted);
  font-size: 12px;
  line-height: 1.45;
}

.content {
  padding: 0 14px 14px;
}

h3 {
  font-size: 13px;
  margin: 14px 0 6px;
}

p, li {
  font-size: 13px;
  line-height: 1.75;
  margin: 6px 0;
}

ul, ol {
  margin: 8px 0 0;
  padding-left: 18px;
}

.box {
  border: 1px dashed #3a4a8b;
  background: rgba(15,23,48,.55);
  border-radius: 12px;
  padding: 10px 12px;
  margin: 10px 0;
}

.label {
  color: var(--muted);
  font-size: 12px;
  margin: 0 0 6px;
}

code { font-family: var(--mono); font-size: 12.5px; }

pre {
  font-family: var(--mono);
  font-size: 12.5px;
  line-height: 1.6;
  margin: 8px 0;
  padding: 10px 12px;
  border: 1px solid var(--line);
  border-radius: 12px;
  background: #070b18;
  overflow: auto;
}

.grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 6px;
}

.kv {
  display: grid;
  grid-template-columns: 140px 1fr;
  gap: 6px 10px;
  align-items: start;
}

.k { color: var(--muted); font-size: 12px; }

footer {
  margin-top: 18px;
  color: var(--muted);
  font-size: 12px;
  line-height: 1.65;
}

@media (min-width: 720px) {
  h1 { font-size: 22px; }
  p, li { font-size: 14px; }
  .kv { grid-template-columns: 180px 1fr; }
  .title { font-size: 15px; }
}
```

  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>n8n × GitHub Webhook 疎通（レベル1）手順書：詰まりポイント込み</h1>
      <p class="sub">
        目的：<b>GitHubのpush → ngrok → ローカルn8n</b> がつながり、WebhookノードのOUTPUTに <code>headers</code>/<code>body</code> が表示される状態を作る。
      </p>
      <div class="callout">
        <b>スマホ向け</b>：章は折りたたみです。上のボタンで「全部開く/閉じる」「手順だけ」「詰まりだけ」を一括切替できます。
      </div>
    </header>

```
<section class="toolbar" aria-label="controls">
  <div class="row">
    <div class="btns">
      <button type="button" id="openAll">すべて開く</button>
      <button type="button" id="closeAll">すべて閉じる</button>
      <button type="button" id="openSteps">手順だけ開く</button>
      <button type="button" id="openTroubles">詰まりだけ開く</button>
    </div>
    <div class="hint">目次リンクを押すと、その章が自動で開きます</div>
  </div>
</section>

<nav class="toc" aria-label="目次">
  <h2>目次</h2>
  <ol>
    <li><a href="#sec-overview">全体像（視点が混ざると詰まる）</a></li>
    <li><a href="#sec-step1">手順1：n8n側でWebhookノードを作る</a></li>
    <li><a href="#sec-step2">手順2：GitHub側でWebhookを登録する</a></li>
    <li><a href="#sec-ngrok">手順2.5：ngrokで公開URLを作る</a></li>
    <li><a href="#sec-step3">手順3：動作確認（テスト受信）</a></li>
    <li><a href="#sec-check">成功/失敗チェック（切り分け順）</a></li>
    <li><a href="#sec-troubles">詰まりポイント一覧（Q→原因→解決）</a></li>
  </ol>
</nav>

<!-- Overview -->
<details id="sec-overview" data-kind="info" open>
  <summary>
    <div class="sumline">
      <span class="tag ok">最初に</span>
      <div>
        <div class="title">全体像：誰がURLを見るのか（視点のズレが原因）</div>
        <div class="meta">localhostはあなたのPC内。GitHubは外部サーバーからPOSTする。</div>
      </div>
    </div>
  </summary>
  <div class="content">
    <p>Webhookの落とし穴は「URLを<b>誰が</b>見るのか」が混ざることです。登場人物は3つです。</p>
    <div class="box">
      <div class="label">登場人物</div>
      <div class="kv">
        <div class="k">n8n（ローカル）</div><div>あなたのPCで待ち受ける（例：<code>http://localhost:5678</code>）</div>
        <div class="k">ngrok（中継）</div><div>外部公開URLを作り、localhostへ転送する</div>
        <div class="k">GitHub（送信側）</div><div>GitHubサーバーからWebhook URLへPOSTする</div>
      </div>
    </div>
    <p>正しい通信経路はこれです：</p>
    <pre><code>GitHub（外） → ngrokの公開URL（外） → localhost:5678（内：n8n）</code></pre>
    <p>よって、GitHubに貼るURLは <b>localhostではなく、ngrokの公開URL</b> になります（Pathはn8nと一致させる）。</p>
  </div>
</details>

<!-- Step 1 -->
<details id="sec-step1" data-kind="step" open>
  <summary>
    <div class="sumline">
      <span class="tag ok">手順</span>
      <div>
        <div class="title">手順1：n8n側：Webhookノードを作る</div>
        <div class="meta">まずは最小設定。認証/レスポンスの作り込みは後でOK。</div>
      </div>
    </div>
  </summary>
  <div class="content">
    <h3>設定（学習フェーズの正解）</h3>
    <div class="box">
      <div class="kv">
        <div class="k">HTTP Method</div><div><code>POST</code></div>
        <div class="k">Path</div><div><code>github-webhook</code>（任意）</div>
        <div class="k">Authentication</div><div><code>None</code></div>
        <div class="k">Respond</div><div><code>Immediately</code>（自動で200 OK）</div>
      </div>
    </div>

    <details data-kind="trouble">
      <summary>
        <div class="sumline">
          <span class="tag warn">詰まり</span>
          <div>
            <div class="title">「レスポンス欄がない／Authenticationが見当たらない」</div>
            <div class="meta">UI差はあるが、レベル1は最小設定で進めてOK。</div>
          </div>
        </div>
      </summary>
      <div class="content">
        <p><b>原因：</b>n8nのUI・バージョン差で項目の見え方が変わります。</p>
        <p><b>解決：</b>レベル1では「GitHubが200 OKを受け取れれば成功」なので、<code>Respond=Immediately</code> で十分です。認証もまずはNoneでOK（署名検証は後段）。</p>
      </div>
    </details>

    <h3>Test URL / Production URL（混乱しやすい点）</h3>
    <ul>
      <li><b>Test URL</b>：<code>Listen for test event</code> 中に受信するためのURL</li>
      <li><b>Production URL</b>：ワークフローを有効化して常時受けるURL</li>
    </ul>
    <p>学習フェーズは <b>Test URLで疎通</b> が安全です。</p>
  </div>
</details>

<!-- Step 2 -->
<details id="sec-step2" data-kind="step" open>
  <summary>
    <div class="sumline">
      <span class="tag ok">手順</span>
      <div>
        <div class="title">手順2：GitHub側：Webhookを登録する</div>
        <div class="meta">リポジトリ Settings → Webhooks → Add webhook。</div>
      </div>
    </div>
  </summary>
  <div class="content">
    <h3>場所（ここが分からず詰まりやすい）</h3>
    <ol>
      <li>対象リポジトリを開く</li>
      <li><b>Settings</b>（⚙）</li>
      <li>左メニュー <b>Webhooks</b></li>
      <li><b>Add webhook</b></li>
    </ol>

    <details data-kind="trouble">
      <summary>
        <div class="sumline">
          <span class="tag warn">詰まり</span>
          <div>
            <div class="title">「GitHub側ってどこのこと？」</div>
            <div class="meta">Webhookはアカウント設定ではなく「リポジトリ単位」。</div>
          </div>
        </div>
      </summary>
      <div class="content">
        <p><b>原因：</b>GitHubの設定は階層が多く、Webhookは<b>リポジトリのSettings</b>にあります。</p>
        <p><b>解決：</b>必ず「対象リポジトリ」→ Settings → Webhooks に入って設定します。</p>
      </div>
    </details>

    <h3>入力値（まずはpushイベントだけ）</h3>
    <div class="box">
      <div class="kv">
        <div class="k">Payload URL</div><div>後述の「ngrok URL + n8nのPath」を設定</div>
        <div class="k">Content type</div><div><code>application/json</code></div>
        <div class="k">Secret</div><div>空でOK（後で署名検証するなら設定）</div>
        <div class="k">Events</div><div><code>Just the push event</code></div>
      </div>
    </div>

    <details data-kind="trouble">
      <summary>
        <div class="sumline">
          <span class="tag bad">詰まり</span>
          <div>
            <div class="title">「localhost は public Internet から届かない」</div>
            <div class="meta">GitHubは外部サーバーから叩く。localhostはあなたのPCに到達できない。</div>
          </div>
        </div>
      </summary>
      <div class="content">
        <p><b>原因：</b>GitHubがPOSTするのはGitHubサーバーから。<code>localhost</code> はGitHub側のlocalhost扱いになり、あなたのPCには届きません。</p>
        <p><b>解決：</b>ngrokで外部公開URLを作り、GitHubにはそのURLを貼ります。</p>
      </div>
    </details>
  </div>
</details>

<!-- Step 2.5 ngrok -->
<details id="sec-ngrok" data-kind="step" open>
  <summary>
    <div class="sumline">
      <span class="tag ok">手順</span>
      <div>
        <div class="title">手順2.5：ngrokで公開URLを作る（学習フェーズの最短ルート）</div>
        <div class="meta">ngrokは「外部URL」を作り、localhostへ中継する。</div>
      </div>
    </div>
  </summary>
  <div class="content">
    <h3>仕組み（なぜn8n設定を変えなくていい？）</h3>
    <pre><code>GitHub → https://xxxx.ngrok-free.dev → http://localhost:5678</code></pre>
    <p>ngrokはn8nの設定を変えません。<b>変えるのは「GitHubに貼るURL」だけ</b>です。</p>

    <h3>初回だけ：アカウント＆authtoken</h3>
    <details data-kind="trouble" open>
      <summary>
        <div class="sumline">
          <span class="tag bad">詰まり</span>
          <div>
            <div class="title">ERR_NGROK_4018：verified account / authtoken が必要</div>
            <div class="meta">無料でも本人紐付けが必須。token登録で解消。</div>
          </div>
        </div>
      </summary>
      <div class="content">
        <p><b>解決手順：</b></p>
        <ol>
          <li>ngrokにサインアップ/ログイン</li>
          <li>ダッシュボードでAuthtokenを取得</li>
          <li>PowerShellで1回だけ実行</li>
        </ol>
        <pre><code>ngrok config add-authtoken YOUR_TOKEN</code></pre>
      </div>
    </details>

    <h3>起動：5678を公開</h3>
    <pre><code>ngrok http 5678</code></pre>
    <p>起動すると <b>Forwarding</b> に公開URLが出ます（例：<code>https://xxxx.ngrok-free.dev</code>）。</p>

    <h3>GitHubに貼るPayload URL（必ずPathを一致させる）</h3>
    <div class="box">
      <div class="label">作り方</div>
      <ul>
        <li><b>ドメイン</b>：ngrokの公開URL</li>
        <li><b>Path</b>：n8nのTest URLの末尾（例：<code>/webhook-test/github-webhook</code>）</li>
      </ul>
      <pre><code>https://xxxx.ngrok-free.dev/webhook-test/github-webhook</code></pre>
    </div>

    <details data-kind="trouble">
      <summary>
        <div class="sumline">
          <span class="tag warn">詰まり</span>
          <div>
            <div class="title">「n8n側のWebhook URLを変える必要ある？」</div>
            <div class="meta">n8nはlocalhostのまま。GitHubに貼る先だけをngrokにする。</div>
          </div>
        </div>
      </summary>
      <div class="content">
        <p><b>原因：</b>URLが2種類（localhostとngrok）出てくるため混乱します。</p>
        <p><b>解決：</b>n8nは受け口（localhost）で固定。GitHubが叩く先だけをngrokにする、と役割分担で整理します。</p>
      </div>
    </details>

    <h3>切り分け用：ngrok管理画面</h3>
    <pre><code>http://127.0.0.1:4040</code></pre>
    <p>ここでGitHubからのPOSTが届いているか確認できます（ヘッダ/ボディも見える）。</p>
  </div>
</details>

<!-- Step 3 -->
<details id="sec-step3" data-kind="step" open>
  <summary>
    <div class="sumline">
      <span class="tag ok">手順</span>
      <div>
        <div class="title">手順3：動作確認（テスト受信）</div>
        <div class="meta">n8nで待つ → GitHubでpush → OUTPUTにJSON。</div>
      </div>
    </div>
  </summary>
  <div class="content">
    <h3>正しい順番</h3>
    <ol>
      <li><b>n8n</b>：Webhookノードで <code>Listen for test event</code></li>
      <li><b>GitHub</b>：pushイベントを発生</li>
      <li><b>n8n</b>：OUTPUTに <code>headers</code>/<code>body</code> が表示</li>
    </ol>

    <details data-kind="trouble">
      <summary>
        <div class="sumline">
          <span class="tag warn">詰まり</span>
          <div>
            <div class="title">「n8nでテストしてるけど、GitHub側で何をすれば？」</div>
            <div class="meta">Webhookは“イベントが起きたら送る”。待つだけでは来ない。</div>
          </div>
        </div>
      </summary>
      <div class="content">
        <p><b>原因：</b>GitHubがWebhookを送るのは、push等のイベントが発生したときだけです。</p>
        <p><b>解決：</b>次のいずれかでpushを発生させます。</p>
      </div>
    </details>

    <div class="box">
      <div class="label">A. ローカルで空コミット（最短）</div>
      <pre><code>git commit --allow-empty -m "test webhook"
```

git push</code></pre> </div> <div class="box"> <div class="label">B. GitHub画面でREADMEを1文字編集</div> <ul> <li>README.md → Edit（鉛筆）</li> <li>空白追加など1文字変更 → Commit changes</li> </ul> </div>

```
    <h3>成功の証拠（あなたの成功画面で見えたもの）</h3>
    <ul>
      <li>OUTPUTに「1 item」</li>
      <li><code>headers.user-agent</code> に <code>GitHub-Hookshot</code></li>
      <li><code>x-github-event: push</code></li>
      <li><code>body.ref: refs/heads/main</code></li>
    </ul>
  </div>
</details>

<!-- Check -->
<details id="sec-check" data-kind="info">
  <summary>
    <div class="sumline">
      <span class="tag ok">チェック</span>
      <div>
        <div class="title">成功/失敗チェック（届かない時の切り分け順）</div>
        <div class="meta">GitHub → ngrok → n8n の順で確認すると迷わない。</div>
      </div>
    </div>
  </summary>
  <div class="content">
    <h3>成功判定</h3>
    <ul>
      <li>n8n OUTPUT に <code>headers</code>/<code>body</code> が出る</li>
      <li><code>x-github-event</code> が <code>push</code></li>
      <li><code>content-type</code> が <code>application/json</code></li>
    </ul>

    <h3>届かない時の切り分け</h3>
    <ol>
      <li><b>GitHub</b>：Webhookの Recent Deliveries が 200 か</li>
      <li><b>ngrok</b>：<code>http://127.0.0.1:4040</code> にPOSTが来ているか</li>
      <li><b>n8n</b>：<code>Listen for test event</code> を押して待機しているか</li>
      <li><b>URL</b>：Payload URL が「ngrokドメイン + n8nのPath」になっているか</li>
    </ol>
  </div>
</details>

<!-- Troubles -->
<details id="sec-troubles" data-kind="trouble">
  <summary>
    <div class="sumline">
      <span class="tag warn">ナレッジ</span>
      <div>
        <div class="title">詰まりポイント一覧（今回の質問 → 原因 → 解決）</div>
        <div class="meta">同じところで止まらないための要点だけ一覧。</div>
      </div>
    </div>
  </summary>
  <div class="content">
    <ol>
      <li><b>Webhookノードの項目が見当たらない</b>：UI差 → レベル1は <code>None</code> / <code>Immediately</code> でOK</li>
      <li><b>GitHub側Webhookの場所が不明</b>：設定階層 → リポジトリ Settings → Webhooks</li>
      <li><b>localhostが使えない</b>：外部サーバー視点 → ngrokで公開URLを作る</li>
      <li><b>ngrokの仕組みが不明</b>：視点混在 → 「公開URL→localhost中継」と整理する</li>
      <li><b>ngrokはダウンロード必要？</b>：常時接続クライアントが必要 → exe実行</li>
      <li><b>ERR_NGROK_4018</b>：authtoken必須 → token登録で解消</li>
      <li><b>n8nのURLを変える？</b>：URLが2種類 → GitHubに貼る先だけngrokにする</li>
      <li><b>GitHub側で何をする？</b>：イベントが必要 → push（空コミット/README編集）</li>
      <li><b>成功の見分け</b>：headers/bodyを見る → <code>GitHub-Hookshot</code> / <code>x-github-event</code> / <code>body.ref</code></li>
    </ol>
  </div>
</details>

<footer>
  <p>
    この資料は「レベル1（疎通）」に絞り、今回のやり取りで出た“詰まり”を原因と解決に分解して再現性を上げたものです。
    次のレベルに進むなら、受信したJSONの <code>body.ref</code> / <code>body.pusher</code> / <code>body.commits</code> から通知文を作るのが最短です。
  </p>
</footer>
```

  </div>

  <script>
    // Robust open/close helpers (no dependencies)
    (function(){
      const all = Array.from(document.querySelectorAll('details'));
      const byKind = (kind) => Array.from(document.querySelectorAll('details[data-kind="' + kind + '"]'));

      function setOpen(nodes, open){
        nodes.forEach(d => { d.open = open; });
      }

      const openAll = document.getElementById('openAll');
      const closeAll = document.getElementById('closeAll');
      const openSteps = document.getElementById('openSteps');
      const openTroubles = document.getElementById('openTroubles');

      if(openAll) openAll.addEventListener('click', () => setOpen(all, true));
      if(closeAll) closeAll.addEventListener('click', () => setOpen(all, false));

      if(openSteps) openSteps.addEventListener('click', () => {
        setOpen(all, false);
        setOpen(byKind('step'), true);
        setOpen(byKind('info'), true);
      });

      if(openTroubles) openTroubles.addEventListener('click', () => {
        setOpen(all, false);
        setOpen(byKind('trouble'), true);
      });

      // Open target section when clicking TOC links
      Array.from(document.querySelectorAll('.toc a')).forEach(a => {
        a.addEventListener('click', () => {
          const id = (a.getAttribute('href') || '').replace('#','');
          const sec = document.getElementById(id);
          if(sec && sec.tagName && sec.tagName.toLowerCase() === 'details') sec.open = true;
        });
      });
    })();
  </script>

</body>
</html>

</body>
</html>