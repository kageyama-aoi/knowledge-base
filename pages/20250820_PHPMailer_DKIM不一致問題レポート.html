<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>[Local Stack] Report: PHPMailer DKIMä¸ä¸€è‡´å•é¡Œ</title>
<style>
  :root{
    --bg:#ffffff; --fg:#1f2937; --muted:#6b7280; --card:#f9fafb; --border:#e5e7eb; --accent:#2563eb; --ok:#059669; --warn:#b45309; --bad:#dc2626;
  }
  .dark{
    --bg:#0b1020; --fg:#e5e7eb; --muted:#9ca3af; --card:#141a2a; --border:#253046; --accent:#60a5fa; --ok:#34d399; --warn:#f59e0b; --bad:#f87171;
  }
  html,body{ height:100%; }
  body{ margin:0; background:var(--bg); color:var(--fg); font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, Arial, sans-serif; line-height:1.65;}
  .container{ max-width: 1080px; margin:0 auto; padding: 24px; }
  header{ display:flex; justify-content:space-between; align-items:center; gap:16px; flex-wrap:wrap; }
  h1{ font-size: clamp(1.4rem, 3vw, 2rem); margin:0 0 8px; line-height:1.2;}
  .subtitle{ color:var(--muted); margin-top:-2px; }
  .toolbar{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  button, .pill{
    border:1px solid var(--border); background: var(--card); color: var(--fg);
    padding:8px 12px; border-radius: 999px; cursor:pointer; font-weight:600;
  }
  button:hover{ border-color: var(--accent); }
  .grid{ display:grid; gap:16px; grid-template-columns: repeat(12, 1fr); }
  .card{ background: var(--card); border:1px solid var(--border); border-radius:14px; padding:16px; }
  .span12{ grid-column: span 12; } .span8{ grid-column: span 8; } .span4{ grid-column: span 4; }
  .kpi{ display:flex; gap:12px; align-items:center; }
  .kpi .dot{ width:10px; height:10px; border-radius:50%; display:inline-block; }
  .ok .dot{ background: var(--ok); } .warn .dot{ background: var(--warn); } .bad .dot{ background: var(--bad); }
  h2{ font-size:1.15rem; margin:0 0 10px; border-left:4px solid var(--accent); padding-left:10px; }
  h3{ font-size:1rem; margin:12px 0 6px; color: var(--accent); }
  code, pre{ background: #0f172a20; padding:2px 6px; border-radius:6px; }
  table{ width:100%; border-collapse:collapse; font-size:0.95rem; }
  th, td{ border:1px solid var(--border); padding:8px; vertical-align:top; }
  th{ background: #00000008; text-align:left; }
  .dark th{ background:#ffffff10; }
  .callout{ border-left:4px solid var(--accent); background: #2563eb10; padding:10px 12px; border-radius:10px; }
  .list-tight li{ margin:4px 0; }
  .muted{ color: var(--muted); }
  .footer{ font-size:0.9rem; color:var(--muted); margin-top:24px; }
  @media (max-width: 900px){
    .span8{ grid-column: span 12; } .span4{ grid-column: span 12; }
  }
  @media print{
    .toolbar{ display:none !important; }
    body{ background:#fff; color:#000; }
    .card{ page-break-inside: avoid; }
  }
</style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>ã€äº‹ä¾‹å ±å‘Šã€‘PHPMaileræ—§ç‰ˆã«ã‚ˆã‚‹DKIMä¸ä¸€è‡´ã¨ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å·®ç•°</h1>
        <div class="subtitle">å¯¾è±¡: é¡§å®¢ã€ŒVKã€/ é€ä¿¡å…ˆ: yahoo.co.jp / é€ä¿¡å…ƒ: vis-school-info@vis-kobe.co.jp</div>
      </div>
      <div class="toolbar">
        <button id="toggleTheme" aria-label="ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ">ğŸŒ— ãƒ€ãƒ¼ã‚¯/ãƒ©ã‚¤ãƒˆ</button>
        <button id="printBtn">ğŸ–¨ï¸ å°åˆ·/PDF</button>
      </div>
    </header>

    <section class="grid">
      <div class="card span12">
        <div class="grid">
          <div class="span4 kpi ok">
            <span class="dot"></span>
            <div><strong>SPF/DMARC</strong><br><span class="muted">ã¨ã‚‚ã«æ­£å¸¸ï¼ˆé¡§å®¢ãƒ»å¼Šç¤¾ã§ç¢ºèªæ¸ˆï¼‰</span></div>
          </div>
          <div class="span4 kpi bad">
            <span class="dot"></span>
            <div><strong>DKIM</strong><br><span class="muted">é¡§å®¢å´ã§ã‚¨ãƒ©ãƒ¼æ¤œçŸ¥ï¼ˆyahoo.co.jpï¼‰</span></div>
          </div>
          <div class="span4 kpi warn">
            <span class="dot"></span>
            <div><strong>æœ¬æ–‡ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å·®ç•°</strong><br><span class="muted">quoted-printable vs 8bit</span></div>
          </div>
        </div>
      </div>

      <div class="card span8">
        <h2>1. æ¦‚è¦</h2>
        <p>ç®¡ç†ç”»é¢ã‹ã‚‰ <code>vis-school-info@vis-kobe.co.jp</code> ã‚’å·®å‡ºäººã«ã—ã¦é€ä¿¡ã—ãŸãƒ¡ãƒ¼ãƒ«ã«ã¤ã„ã¦ã€<strong>é¡§å®¢ã€ŒVKã€ã‹ã‚‰ Yahoo! å®›ã§ DKIM ã‚¨ãƒ©ãƒ¼</strong>ã®å ±å‘ŠãŒã‚ã‚Šã¾ã—ãŸã€‚å¼Šç¤¾ãƒ»é¡§å®¢åŒæ–¹ã®ãƒ†ã‚¹ãƒˆé€ä¿¡ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¯”è¼ƒã—ãŸã¨ã“ã‚ã€<strong>æœ¬æ–‡ã® Content-Transfer-Encoding ãŒä¸ä¸€è‡´</strong>ï¼ˆé¡§å®¢: <code>quoted-printable</code>ã€å¼Šç¤¾: <code>8bit</code>ï¼‰ã§ã—ãŸã€‚</p>
        <div class="callout">
          <strong>çµè«–:</strong> ä½¿ç”¨ã—ã¦ã„ãŸ PHPMailer ãŒ<strong>éå¸¸ã«å¤ã„ï¼ˆv1.72 / 2004å¹´ï¼‰</strong>ãŸã‚ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å‡¦ç†ã¨ DKIM ç½²åã®æ•´åˆæ€§ã«å•é¡ŒãŒç”Ÿã˜ãŸå¯èƒ½æ€§ãŒé«˜ã„ã€‚<br>
          <em>æš«å®šå¯¾å‡¦ã¨ã—ã¦</em> ã‚¢ãƒ—ãƒªå´ã‹ã‚‰ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ <code>8bit</code> ã«å›ºå®šã—ã€äº‹è±¡ã¯è§£æ¶ˆã€‚æ’ä¹…å¯¾ç­–ã¨ã—ã¦ã¯ <strong>PHPMailer 6.x ã¸ã®æ›´æ–°</strong>ãŒå¿…è¦ã€‚
        </div>
      </div>

      <div class="card span4">
        <h2>2. ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ / å½±éŸ¿ç¯„å›²</h2>
        <ul class="list-tight">
          <li>é¡§å®¢ã‹ã‚‰ DKIM ã‚¨ãƒ©ãƒ¼é€£çµ¡ï¼ˆå®›å…ˆ: yahoo.co.jpï¼‰</li>
          <li>é€ä¿¡ãƒ•ã‚¡ã‚¤ãƒ«æ¯”è¼ƒ â†’ <code>Content-Transfer-Encoding</code> ã®å·®ç•°ã‚’ç‰¹å®š</li>
          <li>æš«å®šå¯¾å¿œï¼šã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ <code>8bit</code> æŒ‡å®šï¼ˆTR95495ï¼‰</li>
          <li>çµæœï¼šDKIM ã‚¨ãƒ©ãƒ¼è§£æ¶ˆã‚’ç¢ºèª</li>
        </ul>
        <p class="muted">å½±éŸ¿ã¯ Yahoo! å®›ã¦ã§ä¸»ã«é¡•åœ¨åŒ–ã€‚DKIM ã¯æ”¹è¡Œãƒ»ç©ºç™½ãƒ»ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å·®ã§ã‚‚æ¤œè¨¼ãŒå¤±æ•—ã—å¾—ã¾ã™ã€‚</p>
      </div>

      <div class="card span12">
        <h2>3. æŠ€è¡“çš„èƒŒæ™¯ã¨åŸå› åˆ†æ</h2>
        <h3>3-1. DKIM ã¨ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®é–¢ä¿‚</h3>
        <p>DKIM ã¯ã€Œç½²åæ™‚ã«è¨ˆç®—ã—ãŸæœ¬æ–‡ï¼ˆBodyï¼‰ã®ãƒãƒƒã‚·ãƒ¥ã€ãŒã€å—ä¿¡å´ã§å¾©å…ƒã—ãŸæœ¬æ–‡ãƒãƒƒã‚·ãƒ¥ã¨ä¸€è‡´ã™ã‚‹ã‹ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚<strong>quoted-printable ã¨ 8bit ã§æ”¹è¡Œã‚„ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ãŒç•°ãªã‚‹</strong>ã¨ã€å¾©å…ƒçµæœãŒã‚ºãƒ¬ã€æ¤œè¨¼å¤±æ•—ã®å¼•ãé‡‘ã«ãªã‚Šã¾ã™ã€‚</p>
        <h3>3-2. å¤ã„ PHPMailer ã®å•é¡Œ</h3>
        <ul class="list-tight">
          <li>v1.72ï¼ˆ2004å¹´ï¼‰ã¯ <strong>DKIM æœªå®Ÿè£…æœŸ</strong> ã®ã‚³ãƒ¼ãƒ‰ã§ã€MIME/ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®æ‰±ã„ã‚‚æ—§å¼ã€‚</li>
          <li>æœ¬æ–‡ã‚„ãƒ˜ãƒƒãƒ€ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰/æ”¹è¡Œè¦å‰‡ãŒç¾è¡Œã‚µãƒ¼ãƒé‹ç”¨ã¨é½Ÿé½¬ã‚’èµ·ã“ã™ã“ã¨ãŒã‚ã‚‹ã€‚</li>
          <li>çµæœã¨ã—ã¦ <strong>DKIM canonicalization ã¨æ•´åˆã—ãªã„å‡ºåŠ›</strong>ã«ãªã‚Šã€æ¤œè¨¼ãŒå¤±æ•—ã—ã‚„ã™ã„ã€‚</li>
        </ul>
      </div>

      <div class="card span6">
        <h2>4. æ¯”è¼ƒï¼ˆé€ä¿¡æ™‚ã®æœ¬æ–‡ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼‰</h2>
        <table aria-label="ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ¯”è¼ƒ">
          <thead><tr><th>é€ä¿¡å…ƒ</th><th>Content-Transfer-Encoding</th><th>å‚™è€ƒ</th></tr></thead>
          <tbody>
            <tr><td>é¡§å®¢: VK</td><td><code>quoted-printable</code></td><td>Q-P ã¯æ”¹è¡Œãƒ»ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã«ã‚ˆã‚Šæœ¬æ–‡ã®å†ç¾æ‰‹é †ãŒå¢—ãˆã€DKIM æ¤œè¨¼ã®ã‚ºãƒ¬è¦å› ã«ãªã‚Šã†ã‚‹ã€‚</td></tr>
            <tr><td>å¼Šç¤¾</td><td><code>8bit</code></td><td>ä»Šå›ã€<strong>8bit æŒ‡å®šã§ã‚¨ãƒ©ãƒ¼è§£æ¶ˆ</strong>ã‚’ç¢ºèªã€‚</td></tr>
          </tbody>
        </table>
      </div>

      <div class="card span6">
        <h2>5. å¯¾å¿œæ–¹é‡</h2>
        <h3>5-1. æš«å®šï¼ˆå®Ÿæ–½æ¸ˆï¼‰</h3>
        <ul class="list-tight">
          <li>ã‚¢ãƒ—ãƒªã‹ã‚‰ <code>$mail->Encoding = '8bit';</code> ã‚’æŒ‡å®šï¼ˆTR95495ï¼‰ã€‚</li>
          <li>Yahoo! å®›ã¦ã§ DKIM ã‚¨ãƒ©ãƒ¼è§£æ¶ˆã‚’ç¢ºèªã€‚</li>
        </ul>
        <h3>5-2. æ’ä¹…</h3>
        <ul class="list-tight">
          <li><strong>PHPMailer ã‚’ 6.x æœ€æ–°ã¸æ›´æ–°</strong>ï¼ˆComposer ç®¡ç†æ¨å¥¨ï¼‰ã€‚</li>
          <li>DKIM ã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒã‚¤ãƒ†ã‚£ãƒ–è¨­å®šã‚’ä½¿ç”¨ï¼ˆ<code>DKIM_domain</code>, <code>DKIM_selector</code>, <code>DKIM_private</code> ãªã©ï¼‰ã€‚</li>
          <li>é€ä¿¡ãƒ­ã‚°ï¼ˆãƒ˜ãƒƒãƒ€å«ã‚€ï¼‰ã‚’ä¿ç®¡ã—ã€æ¤œè¨¼å¤±æ•—æ™‚ã«å·®åˆ†æ¯”è¼ƒã§ãã‚‹ä½“åˆ¶ã‚’æ•´å‚™ã€‚</li>
        </ul>
      </div>

      <div class="card span12">
        <h2>6. DKIM è¨­å®šãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆå—ä¿¡å´æ¤œè¨¼ã¨æ•´åˆã•ã›ã‚‹ãŸã‚ã«ï¼‰</h2>
        <ul class="list-tight">
          <li>DNS: <code>selector._domainkey.vis-kobe.co.jp</code> ã«å…¬é–‹éµï¼ˆTXTï¼‰ã‚’æ­£ã—ãè¨­å®š</li>
          <li>ç½²åå¯¾è±¡: <code>From:</code> ã‚’å«ã‚€ãƒ˜ãƒƒãƒ€ã®é¸å®šï¼ˆ<code>h=</code>ï¼‰ã¨æœ¬æ–‡ã® canonicalizationï¼ˆ<code>c=relaxed/relaxed</code> ç­‰ï¼‰</li>
          <li>é€ä¿¡æ™‚: æœ¬æ–‡ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã¨æ”¹è¡Œï¼ˆ<code>\r\n</code>ï¼‰ã®ä¸€è²«æ€§</li>
          <li>é‹ç”¨: ç½²åå¾Œã« MTA/ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã§ãƒ˜ãƒƒãƒ€ã‚’æ›¸ãæ›ãˆãªã„</li>
          <li>æ¤œè¨¼: å—ä¿¡ãƒ˜ãƒƒãƒ€ã® <code>Authentication-Results</code> ã§ <code>dkim=pass</code> ã‚’ç¢ºèª</li>
        </ul>
      </div>

      <div class="card span12">
        <h2>7. ç”¨èªã®æ•´ç†ï¼ˆèª¤è§£ã‚’é¿ã‘ã‚‹è¡¨ç¾ï¼‰</h2>
        <ul class="list-tight">
          <li><strong>åŸå› è¡¨ç¾</strong>ï¼šã€ŒPHPMailer æ—§ç‰ˆã®ä»•æ§˜ã«èµ·å› ã™ã‚‹ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ä¸æ•´åˆã€</li>
          <li><strong>æš«å®šå¯¾å‡¦</strong>ï¼šã€Œã‚¢ãƒ—ãƒªã‹ã‚‰ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å›ºå®šã‚’è¿½åŠ ï¼ˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰ã€</li>
          <li><strong>æ’ä¹…å¯¾ç­–</strong>ï¼šã€ŒPHPMailer 6.x åŒ–ãŠã‚ˆã³ DKIM ç½²åã®æ¨™æº–è¨­å®šã«ç§»è¡Œã€</li>
        </ul>
      </div>

      <div class="card span12">
        <h2>8. å‚è€ƒã‚³ãƒ¼ãƒ‰ï¼ˆPHPMailer 6.x ã§ã® DKIM è¨­å®šä¾‹ï¼‰</h2>
<pre><code>// Composer ã§å°å…¥æ¸ˆã¿ã‚’æƒ³å®š
use PHPMailer\PHPMailer\PHPMailer;
require 'vendor/autoload.php';

$mail = new PHPMailer(true);
$mail->CharSet = 'UTF-8';
$mail->isSMTP();
$mail->Host = 'smtp.example.com';
$mail->SMTPAuth = true;
$mail->Username = 'user@example.com';
$mail->Password = 'app-password-or-oauth';
$mail->SMTPSecure = 'tls'; // 465ãªã‚‰'ssl'
$mail->Port = 587;

// DKIM
$mail->DKIM_domain   = 'vis-kobe.co.jp';
$mail->DKIM_selector = 'selector1';           // ä¾‹
$mail->DKIM_private  = '/path/to/private.key';
$mail->DKIM_identity = $mail->From;

// æœ¬æ–‡ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼ˆå¿…è¦æ™‚ã®ã¿æ˜ç¤ºï¼‰
$mail->Encoding = '8bit'; // æ—¢å®šã§å•é¡Œãªã‘ã‚Œã°çœç•¥

$mail->setFrom('vis-school-info@vis-kobe.co.jp', 'VIS School');
$mail->addAddress('to@yahoo.co.jp');
$mail->isHTML(true);
$mail->Subject = 'ãƒ†ã‚¹ãƒˆ';
$mail->Body    = 'DKIMãƒ†ã‚¹ãƒˆæœ¬æ–‡';
$mail->send();</code></pre>
      </div>

      <div class="card span12">
        <h2>9. ã¾ã¨ã‚ï¼ˆè¦ç‚¹ï¼‰</h2>
        <ul class="list-tight">
          <li>äº‹è±¡ã¯<strong>ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ—§ç‰ˆä»•æ§˜</strong>ãŒå¼•ãé‡‘ã€‚ã‚¢ãƒ—ãƒªä¿®æ­£ã¯ã€Œå›é¿ç­–ã®å®Ÿè£…ã€ã«éããªã„ã€‚</li>
          <li>æš«å®šå¯¾å‡¦ã® <code>8bit</code> æŒ‡å®šã§è§£æ¶ˆã—ãŸãŒã€<strong>æ’ä¹…çš„ã«ã¯ 6.x åŒ–ãŒå¿…é ˆ</strong>ã€‚</li>
          <li>DKIM ã¯ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãƒ»æ”¹è¡Œãƒ»ãƒ˜ãƒƒãƒ€æ•´å½¢ã®å·®ã§ç°¡å˜ã« fail ã™ã‚‹ãŸã‚ã€<strong>ç½²åç›´å¾Œã®å†…å®¹ã‚’å¤‰ãˆãªã„é‹ç”¨</strong>ãŒé‡è¦ã€‚</li>
        </ul>
      </div>
    </section>

    <section class="footer">
      <p>â€» ã“ã®æ–‡æ›¸ã¯ã€é¡§å®¢/ç¤¾å†…å…±æœ‰ã‚’æƒ³å®šã—ãŸ HTML ãƒ¬ãƒãƒ¼ãƒˆã§ã™ã€‚å°åˆ·ãƒœã‚¿ãƒ³ã§ PDF åŒ–ã§ãã¾ã™ã€‚</p>
      <p>â€” è£œè¶³ï¼šæ§‹é€ åŒ–ï¼ˆæ¦‚è¦â†’åŸå› â†’å¯¾ç­–â†’ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼‰ã®é †ã§ã€æ„æ€æ±ºå®šã¨å†ç™ºé˜²æ­¢ã«å¿…è¦ãªæƒ…å ±ã‚’æœ€çŸ­ã§ç¢ºèªã§ãã‚‹ã‚ˆã†ã«è¨­è¨ˆã—ã¦ã„ã¾ã™ã€‚</p>
    </section>
  </div>

<script>
  const root = document.documentElement;
  const toggleBtn = document.getElementById('toggleTheme');
  const printBtn = document.getElementById('printBtn');
  function setTheme(mode){
    if(mode==='dark'){ document.body.classList.add('dark'); }
    else{ document.body.classList.remove('dark'); }
    localStorage.setItem('dkim-theme', mode);
  }
  toggleBtn.addEventListener('click', ()=>{
    const isDark = document.body.classList.toggle('dark');
    localStorage.setItem('dkim-theme', isDark ? 'dark' : 'light');
  });
  printBtn.addEventListener('click', ()=> window.print());
  // åˆæœŸãƒ†ãƒ¼ãƒ
  const saved = localStorage.getItem('dkim-theme');
  if(saved==='dark'){ document.body.classList.add('dark'); }
</script>
</body>
</html>
