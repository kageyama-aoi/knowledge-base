<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Slackï¼ˆBot/Event Subscriptionsï¼‰â†’ n8n å—ä¿¡/æ¤œè¨¼/æŠ•ç¨¿ï¼šãƒŠãƒ¬ãƒƒã‚¸æ‰‹é †æ›¸</title>
</head>
<body>
<h1>Slackï¼ˆBot/Event Subscriptionsï¼‰â†’ n8n å—ä¿¡/æ¤œè¨¼/æŠ•ç¨¿ï¼šãƒŠãƒ¬ãƒƒã‚¸æ‰‹é †æ›¸</h1>
<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Slackï¼ˆBot/Event Subscriptionsï¼‰â†’ n8n å—ä¿¡/æ¤œè¨¼/æŠ•ç¨¿ï¼šãƒŠãƒ¬ãƒƒã‚¸æ‰‹é †æ›¸</title>
  <meta name="description" content="Slackã®Botä½œæˆâ†’Event Subscriptionsâ†’n8n Webhookã§challengeå¿œç­”â†’ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡â†’SlackæŠ•ç¨¿ã®ä¸€é€£ã‚’ã€ãªãœå¿…è¦ã‹/ã—ãªã„ã¨ã©ã†ãªã‚‹ã‹/ã©ã“ã§ä½•ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã‹ã¾ã§æ•´ç†ã€‚" />
  <style>
    :root{
      --bg:#0f1216;
      --panel:#151a21;
      --panel2:#0b0f14;
      --text:#e7edf5;
      --muted:#a9b4c2;
      --border:#253043;
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --good:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --code:#0b1020;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
      --radius2: 12px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic", "Meiryo", sans-serif;
    }
    [data-theme="light"]{
      --bg:#f6f8fb;
      --panel:#ffffff;
      --panel2:#f2f5fb;
      --text:#0f172a;
      --muted:#475569;
      --border:#d7deea;
      --accent:#0284c7;
      --accent2:#6d28d9;
      --good:#059669;
      --warn:#b45309;
      --bad:#e11d48;
      --code:#0b1020;
      --shadow: 0 10px 25px rgba(2,8,23,.12);
    }

    html,body{height:100%;}
    body{
      margin:0;
      font-family:var(--sans);
      background: radial-gradient(1200px 800px at 15% 0%, rgba(125,211,252,.14), transparent 45%),
                  radial-gradient(1000px 700px at 85% 10%, rgba(167,139,250,.12), transparent 45%),
                  var(--bg);
      color:var(--text);
      line-height:1.65;
    }
    a{color:var(--accent); text-decoration:none;}
    a:hover{text-decoration:underline;}
    .wrap{max-width:980px; margin:0 auto; padding:16px 14px 80px;}
    header{
      position: sticky;
      top:0;
      z-index:20;
      backdrop-filter: blur(12px);
      background: color-mix(in oklab, var(--bg) 70%, transparent);
      border-bottom: 1px solid color-mix(in oklab, var(--border) 70%, transparent);
    }
    .head-inner{
      max-width:980px;
      margin:0 auto;
      padding:12px 14px;
      display:flex;
      align-items:center;
      gap:10px;
      justify-content:space-between;
    }
    .title{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width:0;
    }
    .title h1{
      margin:0;
      font-size:16px;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .title .sub{
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .toolbar{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .btn{
      appearance:none;
      border:1px solid var(--border);
      background: color-mix(in oklab, var(--panel) 85%, transparent);
      color:var(--text);
      padding:8px 10px;
      border-radius:12px;
      cursor:pointer;
      font-size:12px;
      box-shadow: 0 1px 0 rgba(255,255,255,.04);
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .btn:hover{border-color: color-mix(in oklab, var(--accent) 40%, var(--border));}
    .btn.primary{
      border-color: color-mix(in oklab, var(--accent) 60%, var(--border));
      background: linear-gradient(135deg, color-mix(in oklab, var(--accent) 22%, var(--panel)), var(--panel));
    }
    .btn.good{
      border-color: color-mix(in oklab, var(--good) 55%, var(--border));
      background: linear-gradient(135deg, color-mix(in oklab, var(--good) 18%, var(--panel)), var(--panel));
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:2px 8px;
      border-radius:999px;
      font-size:12px;
      border:1px solid var(--border);
      color:var(--muted);
      background: color-mix(in oklab, var(--panel) 70%, transparent);
    }

    .hero{
      margin-top:14px;
      padding:18px;
      background: linear-gradient(180deg, color-mix(in oklab, var(--panel) 92%, transparent), color-mix(in oklab, var(--panel) 82%, transparent));
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .hero h2{
      margin:0 0 10px;
      font-size:18px;
    }
    .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
      margin-top:12px;
    }
    @media(min-width:860px){
      .grid{grid-template-columns: 1.2fr .8fr;}
    }
    .card{
      border:1px solid var(--border);
      background: var(--panel);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:14px;
    }
    .card h3{
      margin:0 0 10px;
      font-size:15px;
    }
    .muted{color:var(--muted);}
    .callout{
      border-left:4px solid var(--accent);
      background: color-mix(in oklab, var(--panel2) 80%, transparent);
      border:1px solid color-mix(in oklab, var(--border) 70%, transparent);
      border-radius:14px;
      padding:12px 12px;
      margin:10px 0;
    }
    .callout.good{border-left-color: var(--good);}
    .callout.warn{border-left-color: var(--warn);}
    .callout.bad{border-left-color: var(--bad);}
    .callout .label{
      font-weight:700;
      font-size:12px;
      letter-spacing:.2px;
      margin-bottom:6px;
      display:flex; align-items:center; gap:8px;
    }

    details{
      border:1px solid var(--border);
      background: var(--panel);
      border-radius: var(--radius);
      padding:10px 12px;
      box-shadow: var(--shadow);
    }
    details + details{margin-top:12px;}
    summary{
      cursor:pointer;
      list-style:none;
      font-weight:700;
      font-size:14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    summary::-webkit-details-marker{display:none;}
    .sum-right{
      display:flex; align-items:center; gap:8px; flex-shrink:0;
    }
    .pill{
      font-size:11px;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid var(--border);
      color:var(--muted);
      background: color-mix(in oklab, var(--panel2) 70%, transparent);
    }
    .section{margin-top:14px;}
    .section h4{margin:14px 0 8px; font-size:13px;}
    ul,ol{padding-left:20px;}
    li{margin:6px 0;}
    .hr{height:1px; background: color-mix(in oklab, var(--border) 75%, transparent); margin:14px 0;}

    /* Code block with copy */
    pre{
      margin:10px 0 0;
      background: var(--code);
      color:#e5e7eb;
      border-radius: var(--radius2);
      border:1px solid rgba(255,255,255,.08);
      overflow:auto;
      padding:12px 12px 12px;
      font-family:var(--mono);
      font-size:12px;
      line-height:1.6;
      position:relative;
    }
    code{font-family:var(--mono);}
    .codebar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-top:10px;
      padding:8px 10px;
      border:1px solid var(--border);
      border-radius: var(--radius2);
      background: color-mix(in oklab, var(--panel2) 70%, transparent);
      gap:10px;
    }
    .codebar .hint{font-size:12px; color:var(--muted); min-width:0; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;}
    .copy{
      border:1px solid color-mix(in oklab, var(--accent) 55%, var(--border));
      background: color-mix(in oklab, var(--accent) 12%, var(--panel));
      color:var(--text);
      border-radius:12px;
      padding:8px 10px;
      cursor:pointer;
      font-size:12px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    .copy:active{transform: translateY(1px);}
    .toast{
      position:fixed;
      left:50%;
      bottom:20px;
      transform:translateX(-50%);
      background: color-mix(in oklab, var(--panel) 88%, transparent);
      border:1px solid var(--border);
      box-shadow: var(--shadow);
      padding:10px 12px;
      border-radius: 999px;
      font-size:12px;
      color:var(--text);
      display:none;
      z-index:999;
    }
    .k{
      display:inline-block;
      padding:2px 6px;
      border-radius:8px;
      border:1px solid var(--border);
      background: color-mix(in oklab, var(--panel2) 70%, transparent);
      font-family: var(--mono);
      font-size:11px;
      color: color-mix(in oklab, var(--text) 90%, var(--muted));
    }
    .mini{
      font-size:12px; color:var(--muted);
    }
    .two{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
    }
    @media(min-width:860px){
      .two{grid-template-columns:1fr 1fr;}
    }
    .table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border-radius: 14px;
      border:1px solid var(--border);
    }
    .table th,.table td{
      padding:10px;
      border-bottom:1px solid color-mix(in oklab, var(--border) 75%, transparent);
      vertical-align:top;
      font-size:12px;
    }
    .table th{
      background: color-mix(in oklab, var(--panel2) 70%, transparent);
      text-align:left;
      font-size:12px;
      color: color-mix(in oklab, var(--text) 90%, var(--muted));
    }
    .table tr:last-child td{border-bottom:none;}
    .tag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      font-size:11px;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid var(--border);
      background: color-mix(in oklab, var(--panel2) 65%, transparent);
      color:var(--muted);
    }
    .tag.good{border-color: color-mix(in oklab, var(--good) 50%, var(--border)); color: color-mix(in oklab, var(--good) 65%, var(--muted));}
    .tag.warn{border-color: color-mix(in oklab, var(--warn) 50%, var(--border)); color: color-mix(in oklab, var(--warn) 70%, var(--muted));}
    .tag.bad{border-color: color-mix(in oklab, var(--bad) 50%, var(--border)); color: color-mix(in oklab, var(--bad) 70%, var(--muted));}
    .foot{
      margin-top:14px;
      color:var(--muted);
      font-size:12px;
    }
  </style>
</head>

<body data-theme="dark">
<header>
  <div class="head-inner">
    <div class="title">
      <h1>Slackï¼ˆBot/Event Subscriptionsï¼‰â†’ n8n å—ä¿¡/æ¤œè¨¼/æŠ•ç¨¿ï¼šãƒŠãƒ¬ãƒƒã‚¸æ‰‹é †æ›¸</h1>
      <div class="sub">ã€Œãªãœå¿…è¦ã‹ï¼ã—ãªã„ã¨ã©ã†ãªã‚‹ã‹ï¼ã©ã“ã§ä½•ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã‹ã€ã¾ã§å«ã‚ã¦æ•´ç†</div>
    </div>
    <div class="toolbar">
      <button class="btn" id="btnOpenAll" title="å…¨æ–‡ã‚’å±•é–‹">ã™ã¹ã¦é–‹ã</button>
      <button class="btn" id="btnCloseAll" title="å…¨æ–‡ã‚’æŠ˜ã‚ŠãŸãŸã‚€">ã™ã¹ã¦é–‰ã˜ã‚‹</button>
      <button class="btn primary" id="btnOpenSteps" title="æ‰‹é †ã ã‘ã‚’ã–ã£ã¨è¡¨ç¤º">æ‰‹é †ã ã‘é–‹ã</button>
      <button class="btn" id="btnTheme" title="ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ">ğŸŒ— ãƒ†ãƒ¼ãƒ</button>
    </div>
  </div>
</header>

<div class="wrap">
  <section class="hero">
    <h2>ã“ã®è³‡æ–™ã§ã‚„ã‚‹ã“ã¨</h2>
    <div class="muted">
      Slack ã® <span class="k">Event Subscriptions</span> ã‚’ä½¿ã£ã¦ã€Slack ã‹ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆä¾‹ï¼šæ–°è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰ã‚’ <span class="k">n8n Webhook</span> ã«é€ä¿¡ã—ã€
      n8n å´ã§å—ä¿¡ â†’ æœ€ä½é™ã®æ¤œè¨¼ â†’ Slack ã¸æŠ•ç¨¿ï¼ˆå‹•ä½œç¢ºèªï¼‰ã¾ã§ã®ç­‹æ›¸ãã‚’ä½œã‚Šã¾ã™ã€‚
    </div>

    <div class="grid">
      <div class="card">
        <h3>ãªãœã“ã®è³‡æ–™ãŒå¿…è¦ã‹ï¼ˆç†ç”±ï¼‰</h3>
        <ul>
          <li><b>Slackå´ã¯ã€Œå—ã‘å–ã‚Šå£ã®æ­£å½“æ€§ï¼ˆchallengeï¼‰ã€ã‚’æœ€åˆã«å³ã—ãæ¤œè¨¼</b>ã—ã¾ã™ã€‚ã“ã“ã‚’è¶Šãˆãªã„ã¨ã‚¤ãƒ™ãƒ³ãƒˆãŒä¸€åˆ‡æ¥ã¾ã›ã‚“ã€‚</li>
          <li><b>n8nå´ã¯å—ä¿¡ã¯ç°¡å˜</b>ã§ã™ãŒã€Slackã‚¤ãƒ™ãƒ³ãƒˆã¯ç¨®é¡ãŒå¤šãã€æ§‹é€ ï¼ˆbodyï¼‰ã‚‚æ®µéšçš„ã«å¤‰ã‚ã‚‹ãŸã‚ã€<b>ã©ã“ã‚’å‚ç…§ã™ã¹ãã‹ãŒè¿·ã„ã‚„ã™ã„</b>ã§ã™ã€‚</li>
          <li>å…¸å‹ã‚¨ãƒ©ãƒ¼ï¼ˆä¾‹ï¼š<span class="k">challenge_failed</span>, <span class="k">not_in_channel</span>, rate limitï¼‰ã‚’è¸ã‚€ã¨ã€<b>Slackå´ã®è¨­å®šãƒŸã‚¹ãªã®ã‹ / n8nå´ã®è¨­å®šãƒŸã‚¹ãªã®ã‹</b>ãŒæ··ã–ã‚Šã‚„ã™ã„ã§ã™ã€‚</li>
        </ul>
      </div>

      <div class="card">
        <h3>æœ€çŸ­ã‚´ãƒ¼ãƒ«ï¼ˆãƒã‚§ãƒƒã‚¯ï¼‰</h3>
        <div class="two">
          <div class="callout good">
            <div class="label">âœ… Slackå´</div>
            <div class="mini">
              Event Subscriptions ã® Request URL ãŒ <b>Verified</b> ã«ãªã£ã¦ã„ã‚‹ï¼ˆchallengeãŒè¿”ã£ã¦ã„ã‚‹ï¼‰
            </div>
          </div>
          <div class="callout good">
            <div class="label">âœ… n8nå´</div>
            <div class="mini">
              Webhook ãŒå—ä¿¡ã—ã¦ body ã‚’è¦‹ã‚‰ã‚Œã‚‹ã€‚å¿…è¦ãªã‚‰ Slack ã«æŠ•ç¨¿ã§ãã‚‹ï¼ˆãŸã ã— bot ãŒãƒãƒ£ãƒ³ãƒãƒ«ã«å±…ãªã„ã¨ <span class="k">not_in_channel</span>ï¼‰
            </div>
          </div>
        </div>

        <div class="hr"></div>
        <div class="muted">
          ä»¥é™ã¯ <b>æ‰‹é †</b> ã¨åŒæ™‚ã«ã€å„è¨­å®šã® <b>ç›®çš„</b>ï¼<b>çœç•¥æ™‚ã®ç ´ç¶»</b>ï¼<b>å‡ºã‚‹ã‚¨ãƒ©ãƒ¼ã¨å ´æ‰€</b> ã‚’ã‚»ãƒƒãƒˆã§æ›¸ãã¾ã™ã€‚
        </div>
      </div>
    </div>
  </section>

  <!-- 0. å…¨ä½“åƒ -->
  <details class="section" open data-kind="overview">
    <summary>
      0) å…¨ä½“åƒï¼ˆSlackå´ï¼n8nå´ã®è²¬å‹™ã®åˆ‡ã‚Šåˆ†ã‘ï¼‰
      <span class="sum-right"><span class="pill">æœ€é‡è¦</span><span class="pill">è¿·å­é˜²æ­¢</span></span>
    </summary>

    <div class="section">
      <h4>ç™»å ´äººç‰©ï¼ˆå½¹å‰²ï¼‰</h4>
      <ul>
        <li><b>Slack Appï¼ˆBotï¼‰</b>ï¼šSlackå†…ã«å­˜åœ¨ã™ã‚‹â€œã‚¢ãƒ—ãƒªâ€ã€‚ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­ã‚„ã€æŠ•ç¨¿æ¨©é™ï¼ˆOAuth scopesï¼‰ã‚’æŒã¤ã€‚</li>
        <li><b>Slack Event Subscriptions</b>ï¼šSlackãŒã€Œã‚¤ãƒ™ãƒ³ãƒˆã‚’å¤–éƒ¨URLã¸HTTP POSTã§æŠ•ã’ã‚‹ã€ä»•çµ„ã¿ã€‚æœ€åˆã« <span class="k">challenge</span> ã§å—ã‘å–ã‚Šå£ã‚’æ¤œè¨¼ã™ã‚‹ã€‚</li>
        <li><b>n8n Webhook</b>ï¼šå¤–éƒ¨ã‹ã‚‰ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚‹å…¥å£ã€‚</li>
        <li><b>n8n Respond to Webhook</b>ï¼šWebhookã«å¯¾ã™ã‚‹HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’åˆ¶å¾¡ã™ã‚‹ï¼ˆSlackã® challenge è¿”å´ãªã©ï¼‰ã€‚</li>
        <li><b>n8n Slack node</b>ï¼šSlack API ã‚’å©ã„ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æŠ•ç¨¿ãªã©ã‚’è¡Œã†ï¼ˆBotãŒãƒãƒ£ãƒ³ãƒãƒ«ã«å±…ãªã„ã¨ <span class="k">not_in_channel</span>ï¼‰</li>
      </ul>

      <div class="callout warn">
        <div class="label">ãƒã‚¤ãƒ³ãƒˆï¼ˆãªãœåˆ‡ã‚Šåˆ†ã‘ãŒé›£ã—ããªã‚‹ã‹ï¼‰</div>
        <div>
          Slackã¯ <b>ã€Œã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡å´ã€</b>ã§ã€n8nã¯ <b>ã€Œå—ä¿¡å´ã€</b>ã€‚<br/>
          ãŸã ã—ã€Slackã¯é€ã‚‹å‰ã« <b>å—ä¿¡å´ãŒæœ¬å½“ã«ãã®URLã®æ‰€æœ‰è€…ã‹</b> ã‚’ç¢ºèªã—ãŸã„ã®ã§ã€æœ€åˆã« <span class="k">challenge</span> ã‚’è¦æ±‚ã—ã¾ã™ã€‚<br/>
          ã¤ã¾ã‚Šæœ€åˆã¯ã€Œã‚¤ãƒ™ãƒ³ãƒˆã€ã§ã¯ãªãã€Œæ¤œè¨¼ã€ãŒæ¥ã¾ã™ï¼ˆã“ã“ã§æ··ä¹±ã—ã‚„ã™ã„ï¼‰ã€‚
        </div>
      </div>

      <h4>æœ€å°ãƒ•ãƒ­ãƒ¼ï¼ˆæœ€çŸ­ã§é€šã™ï¼‰</h4>
      <ol>
        <li>Slack App ä½œæˆï¼ˆBotæœ‰åŠ¹åŒ–ï¼‰</li>
        <li>Event Subscriptions ã‚’ ON</li>
        <li>Request URL ã« n8n Webhook URL ã‚’è¨­å®š</li>
        <li>n8n ã§ <span class="k">challenge</span> ã‚’è¿”ã—ã¦ Verified ã«ã™ã‚‹</li>
        <li>è³¼èª­ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆä¾‹ï¼šmessage.channelsï¼‰ã‚’è¿½åŠ ã—ã€å¿…è¦Scopeã‚’ä»˜ä¸</li>
        <li>App ã‚’ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã«å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆæ¨©é™æ›´æ–°ï¼‰</li>
        <li>ã‚¤ãƒ™ãƒ³ãƒˆãŒæ¥ã‚‹ â†’ n8n ãŒå—ä¿¡ã—ã¦å‡¦ç†</li>
      </ol>
    </div>
  </details>

  <!-- 1. Slack App/Bot -->
  <details class="section" open data-kind="steps">
    <summary>
      1) Slackå´ï¼šAppï¼ˆBotï¼‰ã‚’ä½œã‚‹
      <span class="sum-right"><span class="pill">æ‰‹é †</span><span class="pill">Slack</span></span>
    </summary>

    <div class="section">
      <h4>æ‰‹é †</h4>
      <ol>
        <li>Slack API ã®ç®¡ç†ç”»é¢ã§ <b>Create New App</b></li>
        <li>Appåãƒ»Workspaceã‚’é¸ã‚“ã§ä½œæˆ</li>
        <li><b>Bot User</b> ã‚’ä½œæˆï¼ˆAppå†…ã®ã€ŒBotã®äººæ ¼ã€ï¼‰</li>
      </ol>

      <div class="callout">
        <div class="label">ãªãœå¿…è¦ï¼Ÿ</div>
        <div>
          Event Subscriptions ã§å—ã‘å–ã£ãŸã‚¤ãƒ™ãƒ³ãƒˆã‚’ <b>APIã§æŠ•ç¨¿/è¿”ä¿¡</b>ã—ãŸã„å ´åˆã€BotãŒä¸»ä½“ã«ãªã‚Šã¾ã™ã€‚<br/>
          BotãŒç„¡ã„ã¨ã€Œå—ã‘ã‚‹ã ã‘ã€ã¯ã§ãã¦ã‚‚ã€<b>å—ä¿¡å¾Œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæŠ•ç¨¿ãªã©ï¼‰ãŒå¼±ã„</b>ã§ã™ã€‚
        </div>
      </div>

      <div class="callout bad">
        <div class="label">è¨­å®šã—ãªã„ã¨ã©ã†ãªã‚‹ï¼Ÿ</div>
        <div>
          å¾Œã§ n8n ã® Slackãƒãƒ¼ãƒ‰ã§æŠ•ç¨¿ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€Botãƒˆãƒ¼ã‚¯ãƒ³ãŒç„¡ã„ãƒ»æ¨©é™ãŒç„¡ã„ã€ãªã©ã§è©°ã¾ã‚Šã¾ã™ã€‚
        </div>
      </div>
    </div>
  </details>

  <!-- 2. Event Subscriptions -->
  <details class="section" open data-kind="steps">
    <summary>
      2) Slackå´ï¼šEvent Subscriptions ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ï¼ˆRequest URL ã® Verified ã‚’é€šã™ï¼‰
      <span class="sum-right"><span class="pill">æœ€é‡è¦</span><span class="pill">Slack</span></span>
    </summary>

    <div class="section">
      <h4>æ‰‹é †ï¼ˆæ¦‚è¦ï¼‰</h4>
      <ol>
        <li>Slack App ç®¡ç†ç”»é¢ â†’ <b>Event Subscriptions</b></li>
        <li><b>Enable Events</b> ã‚’ ON</li>
        <li><b>Request URL</b> ã« n8n ã® Webhook URL ã‚’å…¥ã‚Œã‚‹</li>
        <li>SlackãŒ POST ã™ã‚‹ <span class="k">type=url_verification</span> ã® body å†…ã® <span class="k">challenge</span> ã‚’ã€n8n ãŒåŒã˜å€¤ã§è¿”ã™</li>
        <li>Slackå´ã§ <b>Verified</b> è¡¨ç¤ºã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª</li>
      </ol>

      <div class="callout">
        <div class="label">ãªãœ challenge ãŒå¿…è¦ï¼Ÿï¼ˆSlackã®æ„å›³ï¼‰</div>
        <div>
          Slackã¯ã€Œç¬¬ä¸‰è€…ãŒå‹æ‰‹ã«URLã‚’ç™»éŒ²ã—ã¦ã€ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç›—ã¿è¦‹ã™ã‚‹ã€ã“ã¨ã‚’é˜²ããŸã„ã§ã™ã€‚<br/>
          ã ã‹ã‚‰ã€ç™»éŒ²ã—ãŸURLãŒâ€œæœ¬å½“ã«å—ã‘å–ã‚Œã‚‹URLâ€ã‹ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã«ã€ã¾ãš <span class="k">challenge</span> ã‚’é€ã£ã¦ã€
          <b>åŒã˜å€¤ã‚’è¿”ã›ã‚‹ã‹</b> ã‚’è¦‹ã¾ã™ã€‚
        </div>
      </div>

      <div class="callout bad">
        <div class="label">ã“ã“ãŒé€šã‚‰ãªã„ã¨ä½•ãŒèµ·ãã‚‹ï¼Ÿ</div>
        <div>
          Verified ã«ãªã‚‰ãªã„é™ã‚Šã€Slackã¯ <b>å®Ÿã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã—ã¾ã›ã‚“</b>ã€‚ã¤ã¾ã‚Šã€æ°¸é ã«ä½•ã‚‚æ¥ã¾ã›ã‚“ã€‚<br/>
          ã€Œn8nå´ã§å—ä¿¡ãŒã§ããªã„ã€ã®ã§ã¯ãªãã€<b>Slackå´ãŒé€ã£ã¦ã„ãªã„</b>çŠ¶æ…‹ã«ãªã‚Šã¾ã™ã€‚
        </div>
      </div>

      <div class="hr"></div>

      <h4>å…¸å‹ã‚¨ãƒ©ãƒ¼ï¼šchallenge_failedï¼ˆã©ã“ã§èµ·ãã‚‹ï¼Ÿï¼‰</h4>
      <table class="table">
        <tr>
          <th style="width:26%;">ç—‡çŠ¶</th>
          <td>Slackå´ã® Request URL ã« <span class="k">challenge_failed</span> ãŒå‡ºã‚‹ / Verified ã«ãªã‚‰ãªã„</td>
        </tr>
        <tr>
          <th>èµ·ãã¦ã„ã‚‹ã“ã¨</th>
          <td>SlackãŒæŠ•ã’ãŸ <span class="k">challenge</span> ã‚’ã€å—ä¿¡å´ãŒæ­£ã—ã„å½¢å¼ã§è¿”ã—ã¦ã„ãªã„</td>
        </tr>
        <tr>
          <th>è¦‹ã‚‹å ´æ‰€</th>
          <td>
            Slack: Event Subscriptions ã® Request URL ã®ä¸‹ã®ãƒ­ã‚°ï¼ˆOur Request / Your Responseï¼‰<br/>
            n8n: Webhook ã®å®Ÿè¡Œãƒ­ã‚°ï¼ˆå—ä¿¡bodyã¨è¿”å´å†…å®¹ï¼‰
          </td>
        </tr>
        <tr>
          <th>ã‚ˆãã‚ã‚‹åŸå› </th>
          <td>
            <ul>
              <li>è¿”å´JSONãŒé•ã†ï¼ˆã‚­ãƒ¼åãŒé•ã†ã€ãƒã‚¹ãƒˆãŒé•ã†ï¼‰</li>
              <li>Content-Type ãŒåˆã£ã¦ãªã„ï¼ˆSlackã¯ JSON ã®æƒ³å®šï¼‰</li>
              <li>n8nå´ãŒã€Œãƒ†ã‚¹ãƒˆURLã€ã ã‘ã§å¾…æ©Ÿã—ã¦ã„ã¦ã€æœ¬ç•ªURLã«æ¥ãŸã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ã‘ã¦ã„ãªã„</li>
            </ul>
          </td>
        </tr>
      </table>
    </div>
  </details>

  <!-- 3. n8n Webhook & Respond -->
  <details class="section" open data-kind="steps">
    <summary>
      3) n8nå´ï¼šWebhookã§å—ã‘ã‚‹ â†’ Respond to Webhook ã§ challenge ã‚’è¿”ã™
      <span class="sum-right"><span class="pill">æ‰‹é †</span><span class="pill">n8n</span></span>
    </summary>

    <div class="section">
      <h4>æœ€å°æ§‹æˆï¼ˆã“ã‚Œã ã‘ã§ Verified ã‚’é€šã™ï¼‰</h4>
      <ol>
        <li>n8n ã§ <b>Webhook</b> ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ï¼ˆHTTP Method: POSTï¼‰</li>
        <li>Webhook ã® <b>Respond</b> ã‚’ <span class="k">Using â€œRespond to Webhookâ€ node</span> ã«è¨­å®š</li>
        <li><b>Respond to Webhook</b> ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’åˆ¶å¾¡</li>
        <li>Slackã‹ã‚‰æ¥ã‚‹ body ã® <span class="k">challenge</span> ã‚’è¿”ã™ JSON ã‚’ä½œã‚‹</li>
        <li>Slack ã® Event Subscriptions ã§ Verified ã‚’ç¢ºèª</li>
      </ol>

      <div class="callout">
        <div class="label">Variables and context ã¯æ°—ã«ã—ãªãã¦ã„ã„ï¼Ÿ</div>
        <div>
          åŸºæœ¬ã¯ <b>æ°—ã«ã—ãªãã¦OK</b> ã§ã™ã€‚<br/>
          Slackã‹ã‚‰æ¥ã‚‹ã®ã¯ <b>Webhookã® INPUT ã®ä¸­ã® body</b>ï¼ˆä¾‹ï¼š<span class="k">$json.body.challenge</span>ï¼‰ã€‚<br/>
          Variables and context ã¯ n8n ã®å®Ÿè¡Œç’°å¢ƒæƒ…å ±ï¼ˆæ—¥æ™‚ã‚„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼IDãªã©ï¼‰ã§ã€Slackã‚¤ãƒ™ãƒ³ãƒˆã®æœ¬ä½“ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
        </div>
      </div>

      <div class="callout warn">
        <div class="label">ãªãœ Respond to Webhook ãŒè¦ã‚‹ï¼Ÿ</div>
        <div>
          Slackã¯ã€ŒPOSTã—ãŸã‚‰ã€ã™ãã«æ­£ã—ã„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã‚‹ã€ã“ã¨ã‚’æœŸå¾…ã—ã¾ã™ã€‚<br/>
          n8nã®å‡¦ç†ãŒé•·å¼•ãï¼ˆSlackæŠ•ç¨¿ãªã©ï¼‰ã¨ã€Slackå´ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚„æ¤œè¨¼å¤±æ•—ã«ãªã‚Šã¾ã™ã€‚<br/>
          ãªã®ã§ã¾ãš <b>å³ãƒ¬ã‚¹ï¼ˆchallengeè¿”å´ï¼‰</b> ã‚’ Respond to Webhook ã§ä½œã‚‹ã®ãŒå®‰å®šã§ã™ã€‚
        </div>
      </div>

      <div class="hr"></div>

      <h4>ï¼ˆé‡è¦ï¼‰challenge è¿”å´ç”¨ï¼šRespond to Webhook ã®è¨­å®šä¾‹</h4>
      <div class="codebar">
        <div class="hint">Respond to Webhook â†’ Respond With: JSON / Response Body: challenge ã‚’ãã®ã¾ã¾è¿”ã™</div>
        <button class="copy" data-copy="#code-challenge">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
      </div>
      <pre id="code-challenge"><code>{
  "challenge": "={{$json.body.challenge}}"
}</code></pre>

      <div class="callout">
        <div class="label">ãªãœã“ã®å½¢ï¼Ÿ</div>
        <div>
          Slackã¯ <span class="k">url_verification</span> ã®ã¨ãã€å—ä¿¡å´ã«ã€Œchallengeæ–‡å­—åˆ—ã‚’è¿”ã—ã¦ã€ã¨è¦æ±‚ã—ã¾ã™ã€‚<br/>
          n8nã§ã¯ Webhook ãŒå—ã‘å–ã£ãŸ body ãŒ <span class="k">$json.body</span> ã«å…¥ã‚‹ã“ã¨ãŒå¤šã„ã®ã§ã€
          <span class="k">{{$json.body.challenge}}</span> ã‚’è¿”ã™ã®ãŒæœ€çŸ­ã§ã™ã€‚
        </div>
      </div>

      <div class="callout bad">
        <div class="label">ã“ã“ã§ã®è½ã¨ã—ç©´</div>
        <ul>
          <li>å¼ãŒæ–‡å­—åˆ—ã¨ã—ã¦å›ºå®šã«ãªã£ã¦ã„ã‚‹ï¼ˆExpressionãƒ¢ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ãªã„ï¼‰</li>
          <li><span class="k">$json.challenge</span> ã‚’è¦‹ã«è¡Œã£ã¦ã—ã¾ã„ã€å®Ÿãƒ‡ãƒ¼ã‚¿ã¯ <span class="k">$json.body.challenge</span> ã«å±…ã‚‹</li>
          <li>Webhook ãŒ â€œTest URLâ€ å¾…æ©Ÿä¸­ãªã®ã«ã€Slackã® Request URL ã¯ â€œProduction URLâ€ ã‚’å©ã„ã¦ã„ã‚‹</li>
        </ul>
      </div>

      <div class="hr"></div>

      <h4>Slackã‹ã‚‰æ¥ã‚‹ body ã®ä¾‹ï¼ˆurl_verificationï¼‰</h4>
      <div class="codebar">
        <div class="hint">Slack â†’ n8n ã«æœ€åˆã«æ¥ã‚‹ã®ã¯â€œã‚¤ãƒ™ãƒ³ãƒˆâ€ã§ã¯ãªãâ€œæ¤œè¨¼â€</div>
        <button class="copy" data-copy="#code-urlveri">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
      </div>
      <pre id="code-urlveri"><code>{
  "token": "ï¼ˆSlackå´ã®æ¤œè¨¼ç”¨ï¼‰",
  "challenge": "Bh8uox4x...ï¼ˆé•·ã„æ–‡å­—åˆ—ï¼‰",
  "type": "url_verification"
}</code></pre>
    </div>
  </details>

  <!-- 4. Slackã§ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­ -->
  <details class="section" open data-kind="steps">
    <summary>
      4) Slackå´ï¼šè³¼èª­ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹ï¼ˆmessage.channels ãªã©ï¼‰ï¼‹ Scope ã‚’ä»˜ä¸ã™ã‚‹
      <span class="sum-right"><span class="pill">æ‰‹é †</span><span class="pill">Slack</span></span>
    </summary>

    <div class="section">
      <h4>æ‰‹é †</h4>
      <ol>
        <li>Event Subscriptions â†’ <b>Subscribe to bot events</b></li>
        <li>ä¾‹ï¼š<span class="k">message.channels</span> ã‚’è¿½åŠ ï¼ˆãƒãƒ£ãƒ³ãƒãƒ«æŠ•ç¨¿ã®ã‚¤ãƒ™ãƒ³ãƒˆï¼‰</li>
        <li>è¿½åŠ ã™ã‚‹ã¨ Slack ãŒã€Œå¿…è¦ãª OAuth scopeã€ã‚’æ¡ˆå†…/è‡ªå‹•è¿½åŠ ã™ã‚‹</li>
        <li><b>Scopesã‚’å¤‰ãˆãŸã‚‰å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</b>ï¼ˆInstall App â†’ Reinstallï¼‰</li>
      </ol>

      <div class="callout">
        <div class="label">ãªãœ scope ãŒå¿…è¦ï¼Ÿ</div>
        <div>
          Slackã¯ã€Œã‚¢ãƒ—ãƒªãŒä½•ã‚’ã§ãã‚‹ã‹ã€ã‚’ <b>æ˜ç¤ºçš„ãªæ¨©é™ï¼ˆscopeï¼‰</b> ã§ç®¡ç†ã—ã¾ã™ã€‚<br/>
          ãŸã¨ãˆã° <span class="k">message.channels</span> ã‚’è³¼èª­ã™ã‚‹ãªã‚‰ã€
          BotãŒãƒãƒ£ãƒ³ãƒãƒ«ã®å±¥æ­´ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ <span class="k">channels:history</span> ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚
        </div>
      </div>

      <div class="callout warn">
        <div class="label">å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãªã„ã¨ã©ã†ãªã‚‹ï¼Ÿ</div>
        <div>
          ç”»é¢ä¸Šã¯ scope ãŒä»˜ã„ãŸã‚ˆã†ã«è¦‹ãˆã¦ã‚‚ã€ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹å´ã®åŒæ„ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³å†ç™ºè¡Œï¼‰ãŒæ›´æ–°ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<br/>
          çµæœã€n8nã®Slackãƒãƒ¼ãƒ‰ãŒ <b>æ¨©é™ä¸è¶³ã‚¨ãƒ©ãƒ¼</b> ã«ãªã‚Šã¾ã™ã€‚
        </div>
      </div>
    </div>
  </details>

  <!-- 5. n8nå´ï¼šå—ä¿¡ç¢ºèªï¼ˆè»½ã„å‹•ä½œç¢ºèªã®ãƒãƒ¼ãƒ‰ï¼‰ -->
  <details class="section" open data-kind="steps">
    <summary>
      5) n8nå´ï¼šå—ã‘å–ã‚Šã‚’è»½ãå‹•ä½œç¢ºèªã™ã‚‹ï¼ˆãŠã™ã™ã‚ãƒãƒ¼ãƒ‰æ§‹æˆï¼‰
      <span class="sum-right"><span class="pill">æ‰‹é †</span><span class="pill">n8n</span></span>
    </summary>

    <div class="section">
      <h4>æœ€åˆã¯ã“ã‚Œã ã‘ã§ååˆ†ï¼ˆå—ä¿¡ç¢ºèªç”¨ï¼‰</h4>
      <ol>
        <li><b>Webhook</b>ï¼ˆå—ä¿¡ï¼‰</li>
        <li><b>Respond to Webhook</b>ï¼ˆchallengeè¿”å´ or 200å¿œç­”ï¼‰</li>
        <li><b>Set / Edit Fields</b>ï¼ˆè¦‹ãŸã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŠœãå‡ºã—ã¦æ•´å½¢ï¼‰</li>
        <li><b>ï¼ˆä»»æ„ï¼‰Slack: Send a message</b>ï¼ˆå—ä¿¡å†…å®¹ã‚’Slackã«æŠ•ã’è¿”ã—ã¦ç¢ºèªï¼‰</li>
      </ol>

      <div class="callout">
        <div class="label">ãªãœ â€œSet / Edit Fieldsâ€ ãŒä¾¿åˆ©ï¼Ÿ</div>
        <div>
          Slackã‚¤ãƒ™ãƒ³ãƒˆã®bodyã¯å¤§ãã„ã®ã§ã€ã¾ãšã¯å¿…è¦ãªé …ç›®ã ã‘æŠ½å‡ºã—ãŸæ–¹ãŒç†è§£ãŒé€Ÿã„ã§ã™ã€‚<br/>
          ä¾‹ï¼ševentã®typeã‚„textã ã‘å–ã‚Šå‡ºã™ã€ãªã©ã€‚
        </div>
      </div>

      <div class="callout warn">
        <div class="label">æ³¨æ„ï¼šurl_verification ã¨ event_callback ã¯ body æ§‹é€ ãŒé•ã†</div>
        <div>
          æœ€åˆã«æ¥ã‚‹ <span class="k">url_verification</span> ã«ã¯ <span class="k">body.event</span> ãŒç„¡ã„ã§ã™ã€‚<br/>
          å®Ÿã‚¤ãƒ™ãƒ³ãƒˆï¼ˆ<span class="k">event_callback</span>ï¼‰ã«ãªã‚‹ã¨ <span class="k">body.event</span> ãŒå‡ºã¦ãã¾ã™ã€‚<br/>
          ãªã®ã§ <b>ã€Œevent ã‚’å‚ç…§ã™ã‚‹ãƒãƒ¼ãƒ‰ã€ã¯ url_verification ã®æ™‚ç‚¹ã§ã¯å¿…ãšç©ºã«ãªã‚‹</b> ã®ãŒæ­£å¸¸ã§ã™ã€‚
        </div>
      </div>

      <div class="hr"></div>

      <h4>ï¼ˆä¾‹ï¼‰Edit Fields ã§ event_type / text ã‚’æŠœãå‡ºã™</h4>
      <div class="codebar">
        <div class="hint">Edit Fieldsï¼ˆManual Mappingï¼‰ã§ä½¿ã† Expression ä¾‹</div>
        <button class="copy" data-copy="#code-editfields">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
      </div>
      <pre id="code-editfields"><code>// event_callback ã®ã¨ãï¼ˆå®Ÿã‚¤ãƒ™ãƒ³ãƒˆï¼‰ã«å­˜åœ¨ã™ã‚‹æƒ³å®š
event_type = {{$json.body.event.type}}
text       = {{$json.body.event.text}}

// url_verification ã®ã¨ãã¯ body.event ãŒç„¡ã„ã®ã§ç©ºã«ãªã‚‹ï¼ˆæ­£å¸¸ï¼‰</code></pre>

      <div class="callout">
        <div class="label">ãªãœ $json.body ã‚’è¦‹ã‚‹ï¼Ÿ</div>
        <div>
          n8n ã® Webhook ãƒãƒ¼ãƒ‰ã¯ã€å—ã‘å–ã£ãŸ HTTP body ã‚’ <span class="k">$json.body</span> é…ä¸‹ã«å…¥ã‚Œã‚‹å½¢ã«ãªã‚Šã‚„ã™ã„ã§ã™ã€‚<br/>
          ã‚ãªãŸã®ã‚¹ã‚¯ã‚·ãƒ§ã§ã‚‚ <span class="k">body.token / body.challenge / body.type</span> ãŒè¦‹ãˆã¦ã„ã‚‹ã®ã§ã€
          ãã®å»¶é•·ã§ <span class="k">body.event</span> ã‚’è¿½ã†ã®ãŒç­‹ã§ã™ã€‚
        </div>
      </div>
    </div>
  </details>

  <!-- 6. Slackã¸æŠ•ç¨¿ã—ã¦ç¢ºèª -->
  <details class="section" open data-kind="steps">
    <summary>
      6) n8nå´ï¼šSlackã«æŠ•ç¨¿ã—ã¦ã€Œå—ä¿¡â†’å‡¦ç†â†’å‡ºåŠ›ã€ã‚’ç›®è¦–ç¢ºèªã™ã‚‹
      <span class="sum-right"><span class="pill">æ‰‹é †</span><span class="pill">n8n</span></span>
    </summary>

    <div class="section">
      <h4>ãŠã™ã™ã‚ï¼šæŠ•ç¨¿ã¯ â€œã¾ãšå›ºå®šæ–‡â€ â†’ æ¬¡ã« â€œå—ä¿¡å†…å®¹ã‚’åŸ‹ã‚è¾¼ã‚€â€</h4>
      <ol>
        <li>Slackãƒãƒ¼ãƒ‰ï¼ˆSend a messageï¼‰ã‚’è¿½åŠ </li>
        <li>æŠ•ç¨¿å…ˆãƒãƒ£ãƒ³ãƒãƒ«ã‚’æŒ‡å®šï¼ˆä¾‹ï¼š#98_testï¼‰</li>
        <li>æœ€åˆã¯å›ºå®šæ–‡ï¼ˆä¾‹ï¼š<span class="k">å—ä¿¡ã—ã¾ã—ãŸ</span>ï¼‰ã§é€ã£ã¦ç–é€šã‚’è¦‹ã‚‹</li>
        <li>ç–é€šã§ããŸã‚‰ã€Edit Fields ã®çµæœï¼ˆevent_type/textï¼‰ã‚’åŸ‹ã‚è¾¼ã‚€</li>
      </ol>

      <div class="callout warn">
        <div class="label">ã€ŒSend and Wait for Responseã€ã¯æœ€åˆã¯éæ¨å¥¨ï¼ˆç†ç”±ï¼‰</div>
        <div>
          â€œWaitâ€ ç³»ã¯ã€è¿”ç­”å¾…ã¡ã§å®Ÿè¡ŒãŒ â€œWaitingâ€ çŠ¶æ…‹ã«ãªã‚Šã€ã‚¤ãƒ™ãƒ³ãƒˆé€£æ‰“ã§è©°ã¾ã‚Šã‚„ã™ã„ã§ã™ã€‚<br/>
          æœ€åˆã®å‹•ä½œç¢ºèªã¯ <b>Sendï¼ˆé€ä¿¡ã®ã¿ï¼‰</b> ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚
        </div>
      </div>

      <div class="hr"></div>

      <h4>å…¸å‹ã‚¨ãƒ©ãƒ¼ï¼šnot_in_channelï¼ˆã©ã“ã§èµ·ãã‚‹ï¼Ÿï¼‰</h4>
      <table class="table">
        <tr>
          <th style="width:26%;">ç—‡çŠ¶</th>
          <td>n8n ã® Slackãƒãƒ¼ãƒ‰ã§ <span class="k">not_in_channel</span></td>
        </tr>
        <tr>
          <th>èµ·ãã¦ã„ã‚‹ã“ã¨</th>
          <td>BotãŒãã®ãƒãƒ£ãƒ³ãƒãƒ«ã®ãƒ¡ãƒ³ãƒãƒ¼ã§ã¯ãªã„ï¼ˆæ‹›å¾…ã•ã‚Œã¦ã„ãªã„ï¼‰</td>
        </tr>
        <tr>
          <th>è¦‹ã‚‹å ´æ‰€</th>
          <td>n8n: Execution â†’ Slackãƒãƒ¼ãƒ‰ã®ã‚¨ãƒ©ãƒ¼è©³ç´°</td>
        </tr>
        <tr>
          <th>å¯¾å‡¦</th>
          <td>
            Slackã§å¯¾è±¡ãƒãƒ£ãƒ³ãƒãƒ«ã«ç§»å‹•ã—ã€<span class="k">/invite @ã‚ãªãŸã®Botå</span> ã‚’å®Ÿè¡Œï¼ˆã¾ãŸã¯ãƒãƒ£ãƒ³ãƒãƒ«ã®ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ ã‹ã‚‰Botã‚’å…¥ã‚Œã‚‹ï¼‰
          </td>
        </tr>
      </table>

      <div class="callout good">
        <div class="label">ã“ã®ã‚¨ãƒ©ãƒ¼ã¯â€œæ­£ã—ã„å¤±æ•—â€</div>
        <div>
          å—ä¿¡â†’å‡¦ç†â†’æŠ•ç¨¿ã¾ã§æ¥ã¦ã€æœ€å¾Œã®æŠ•ç¨¿æ¨©é™ã§è½ã¡ã¦ã„ã¾ã™ã€‚<br/>
          ã¤ã¾ã‚Šã€å‰æ®µï¼ˆWebhookå—ä¿¡ã‚„æ•´å½¢ï¼‰ã¯æ¦‚ã­å‹•ã„ã¦ã„ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚
        </div>
      </div>

      <h4>å…¸å‹ã‚¨ãƒ©ãƒ¼ï¼šThe service is receiving too many requests from youï¼ˆrate limitï¼‰</h4>
      <table class="table">
        <tr>
          <th style="width:26%;">ç—‡çŠ¶</th>
          <td>Slackãƒãƒ¼ãƒ‰ã§ã€Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå¤šã™ãã‚‹ã€ç³»ã®ã‚¨ãƒ©ãƒ¼ï¼ˆé€£æ‰“ã™ã‚‹ã¨èµ·ãã‚„ã™ã„ï¼‰</td>
        </tr>
        <tr>
          <th>èµ·ãã¦ã„ã‚‹ã“ã¨</th>
          <td>çŸ­æ™‚é–“ã« Slack API ã‚’å©ãã™ããŸï¼ˆn8nã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œé€£æ‰“ã€ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—ãªã©ï¼‰</td>
        </tr>
        <tr>
          <th>è¦‹ã‚‹å ´æ‰€</th>
          <td>n8n: Slackãƒãƒ¼ãƒ‰ã®ã‚¨ãƒ©ãƒ¼ / å®Ÿè¡Œå±¥æ­´ãŒ Waiting/Error ã§å¢—ãˆã‚‹</td>
        </tr>
        <tr>
          <th>å¯¾å‡¦</th>
          <td>
            <ul>
              <li>æŠ•ç¨¿ãƒãƒ¼ãƒ‰ã‚’ä¸€æ—¦å¤–ã—ã¦å—ä¿¡ç¢ºèªã ã‘ã«ã™ã‚‹</li>
              <li>â€œWaitâ€ ç³»ã‚’é¿ã‘ã‚‹ / å®Ÿè¡Œé€£æ‰“ã—ãªã„</li>
              <li>ãƒ«ãƒ¼ãƒ—ï¼ˆè‡ªåˆ†ã®æŠ•ç¨¿ã‚’ãƒˆãƒªã‚¬ãƒ¼ã«ã—ã¦å†æŠ•ç¨¿ï¼‰ã‚’é˜²ã</li>
            </ul>
          </td>
        </tr>
      </table>

      <div class="callout warn">
        <div class="label">ãƒ«ãƒ¼ãƒ—å¯¾ç­–ï¼ˆæœ€ä½é™ï¼‰</div>
        <div>
          ã€Œã“ã®BotãŒæŠ•ç¨¿ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ç„¡è¦–ã™ã‚‹ã€ãƒ•ã‚£ãƒ«ã‚¿ã‚’å…¥ã‚Œã‚‹ã¨äº‹æ•…ãŒæ¸›ã‚Šã¾ã™ã€‚<br/>
          ä¾‹ï¼šbody.event.bot_id ãŒã‚ã‚‹å ´åˆã¯å‡¦ç†ã—ãªã„ã€ãªã©ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆç¨®åˆ¥ã«ã‚ˆã‚Šå·®ã‚ã‚Šï¼‰ã€‚
        </div>
      </div>
    </div>
  </details>

  <!-- 7. â€œç­‹æ›¸ãâ€ã¨ã—ã¦å†ç¾ã™ã‚‹ï¼ˆã¾ã¨ã‚ï¼‰ -->
  <details class="section" open data-kind="overview">
    <summary>
      7) ç­‹æ›¸ãï¼ˆå†ç¾æ‰‹é †ã¾ã¨ã‚ï¼šãªãœ/çœç•¥æ™‚/ã‚¨ãƒ©ãƒ¼å ´æ‰€è¾¼ã¿ï¼‰
      <span class="sum-right"><span class="pill">ã¾ã¨ã‚</span><span class="pill">å†ç¾æ€§</span></span>
    </summary>

    <div class="section">
      <h4>ç­‹æ›¸ãï¼ˆã‚ãªãŸã®ä»Šå›ã®å­¦ã³ã®æµã‚Œã‚’â€œå†ç¾æ‰‹é †â€ã«è½ã¨ã™ï¼‰</h4>
      <ol>
        <li>
          <b>Slack App ã‚’æ–°è¦ä½œæˆ</b><br/>
          <span class="muted">ç†ç”±ï¼š</span>ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­ã¨æŠ•ç¨¿ã®ä¸»ä½“ã‚’ä½œã‚‹ï¼ˆBotï¼‰<br/>
          <span class="muted">çœç•¥ï¼š</span>å¾Œã§æŠ•ç¨¿/æ¨©é™ã§è©°ã¾ã‚‹
        </li>
        <li>
          <b>Event Subscriptions ã‚’ ON</b><br/>
          <span class="muted">ç†ç”±ï¼š</span>Slackã‹ã‚‰å¤–éƒ¨ã¸ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ã‚‹ä»•çµ„ã¿ã‚’æœ‰åŠ¹åŒ–<br/>
          <span class="muted">çœç•¥ï¼š</span>ãã‚‚ãã‚‚ã‚¤ãƒ™ãƒ³ãƒˆãŒé€ã‚‰ã‚Œãªã„
        </li>
        <li>
          <b>n8n Webhook ã‚’ç”¨æ„ï¼ˆPOSTï¼‰</b><br/>
          <span class="muted">ç†ç”±ï¼š</span>å—ã‘å£ã‚’ä½œã‚‹ï¼ˆSlackã¯ã“ã“ã«POSTï¼‰<br/>
          <span class="muted">çœç•¥ï¼š</span>Request URL ã®æ¤œè¨¼ãŒä¸å¯èƒ½
        </li>
        <li>
          <b>Respond to Webhook ã§ challenge ã‚’è¿”ã™</b><br/>
          <span class="muted">ç†ç”±ï¼š</span>Slackã® URL æ‰€æœ‰ç¢ºèªã«ç­”ãˆã‚‹ï¼ˆVerifiedï¼‰<br/>
          <span class="muted">çœç•¥ï¼š</span>Slackå´ã§ <span class="k">challenge_failed</span>ï¼ˆEvent Subscriptionsç”»é¢ï¼‰
        </li>
        <li>
          <b>è³¼èª­ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ ï¼ˆä¾‹ï¼šmessage.channelsï¼‰</b><br/>
          <span class="muted">ç†ç”±ï¼š</span>ä½•ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ã£ã¦æ¬²ã—ã„ã‹ã‚’Slackã«æŒ‡ç¤º<br/>
          <span class="muted">çœç•¥ï¼š</span>Verifiedã§ã‚‚ä½•ã‚‚æ¥ãªã„
        </li>
        <li>
          <b>Scopes ã‚’æ›´æ–° â†’ å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</b><br/>
          <span class="muted">ç†ç”±ï¼š</span>ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹å´ã®åŒæ„ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ï¼‰ã‚’æ›´æ–°<br/>
          <span class="muted">çœç•¥ï¼š</span>n8nã®Slackãƒãƒ¼ãƒ‰ã§æ¨©é™ä¸è¶³
        </li>
        <li>
          <b>n8n ã§å—ä¿¡ â†’ Edit Fields ã§è¦‹ãŸã„é …ç›®ã‚’æŠ½å‡º</b><br/>
          <span class="muted">ç†ç”±ï¼š</span>ã‚¤ãƒ™ãƒ³ãƒˆæ§‹é€ ã‚’ç†è§£ã—ã‚„ã™ãã™ã‚‹<br/>
          <span class="muted">æ³¨æ„ï¼š</span>url_verification ã«ã¯ event ãŒç„¡ã„ï¼ˆç©ºã§æ­£å¸¸ï¼‰
        </li>
        <li>
          <b>n8n ã‹ã‚‰ Slack ã¸æŠ•ç¨¿ï¼ˆå‹•ä½œç¢ºèªï¼‰</b><br/>
          <span class="muted">ç†ç”±ï¼š</span>â€œå—ä¿¡â†’å‡¦ç†â†’å‡ºåŠ›â€ã‚’ç›®è¦–ã§ãã‚‹<br/>
          <span class="muted">å¤±æ•—ä¾‹ï¼š</span><span class="k">not_in_channel</span>ï¼ˆBotãŒãƒãƒ£ãƒ³ãƒãƒ«ã«å±…ãªã„ï¼‰
        </li>
      </ol>

      <div class="callout good">
        <div class="label">ã„ã¾ã®çŠ¶æ…‹ã®è©•ä¾¡ï¼ˆã‚ãªãŸã®åˆ°é”ç‚¹ï¼‰</div>
        <div>
          Slackå´ã§ Request URL ãŒ <b>Verified</b> ã«ãªã£ã¦ã„ã‚‹ãªã‚‰ã€æœ€å¤§ã®é–¢é–€ï¼ˆchallengeï¼‰ã¯è¶Šãˆã¦ã„ã¾ã™ã€‚<br/>
          ã“ã“ã‹ã‚‰å…ˆã¯ã€Œã‚¤ãƒ™ãƒ³ãƒˆç¨®é¡ã€ã€ŒæŠ•ç¨¿æ¨©é™ï¼ˆãƒãƒ£ãƒ³ãƒãƒ«å‚åŠ ï¼‰ã€ã€Œãƒ«ãƒ¼ãƒ—ã¨ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã€ãªã©ã€<b>é‹ç”¨å¯„ã‚Šã®è©°ã¾ã‚Š</b>ãŒä¸­å¿ƒã«ãªã‚Šã¾ã™ã€‚
        </div>
      </div>
    </div>
  </details>

  <!-- 8. ã‚³ãƒ”ãƒšç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ï¼ˆæœ€å°æ§‹æˆï¼‰ -->
  <details class="section" open data-kind="code">
    <summary>
      8) ã‚³ãƒ”ãƒšç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ï¼šæœ€å°ã® n8n æ§‹æˆï¼ˆWebhookâ†’Respondâ†’ï¼ˆä»»æ„ï¼‰æŠ½å‡ºâ†’æŠ•ç¨¿ï¼‰
      <span class="sum-right"><span class="pill">ã‚³ãƒ”ãƒš</span><span class="pill">æœ€å°</span></span>
    </summary>

    <div class="section">
      <h4>Respond to Webhookï¼ˆchallengeè¿”ã—ï¼‰</h4>
      <div class="codebar">
        <div class="hint">Slackã® Request URL æ¤œè¨¼ã‚’é€šã™ãŸã‚ã®æœ€å°ãƒ¬ã‚¹ãƒãƒ³ã‚¹</div>
        <button class="copy" data-copy="#tpl-respond">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
      </div>
      <pre id="tpl-respond"><code>{
  "challenge": "={{$json.body.challenge}}"
}</code></pre>

      <h4>æŠ½å‡ºï¼ˆEdit Fields / Setï¼‰ã§è¦‹ã‚‹é …ç›®ï¼ˆevent_callbackæƒ³å®šï¼‰</h4>
      <div class="codebar">
        <div class="hint">å®Ÿã‚¤ãƒ™ãƒ³ãƒˆãŒæ¥ãŸã¨ãã«ã ã‘åŸ‹ã¾ã‚‹ï¼ˆurl_verificationã§ã¯ç©ºï¼‰</div>
        <button class="copy" data-copy="#tpl-extract">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
      </div>
      <pre id="tpl-extract"><code>event_type = {{$json.body.event.type}}
text       = {{$json.body.event.text}}
channel    = {{$json.body.event.channel}}
user       = {{$json.body.event.user}}</code></pre>

      <h4>Slackã¸æŠ•ç¨¿ï¼ˆæœ€åˆã¯å›ºå®šæ–‡ï¼‰</h4>
      <div class="codebar">
        <div class="hint">ç–é€šç¢ºèªï¼šã¾ãšã¯å›ºå®šæ–‡ â†’ æ¬¡ã«æŠ½å‡ºå€¤ã‚’åŸ‹ã‚è¾¼ã‚€</div>
        <button class="copy" data-copy="#tpl-post">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
      </div>
      <pre id="tpl-post"><code>âœ… n8n å—ä¿¡ã—ã¾ã—ãŸ
type: {{$json.event_type}}
text: {{$json.text}}</code></pre>

      <div class="callout warn">
        <div class="label">è£œè¶³ï¼šãªãœâ€œå›ºå®šæ–‡â€ã‹ã‚‰ï¼Ÿ</div>
        <div>
          å—ä¿¡ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚„ event ã®å½¢ãŒæºã‚Œã¦ã„ã‚‹æ®µéšã§ã€ã„ããªã‚Šè¤‡é›‘ãªåŸ‹ã‚è¾¼ã¿ã‚’ã™ã‚‹ã¨åŸå› ãŒè¿½ã„ã«ãã„ã§ã™ã€‚<br/>
          ã€ŒæŠ•ç¨¿ã§ãã‚‹ã€ã“ã¨ã‚’ã¾ãšç¢ºå®šã•ã›ã‚‹ã¨ã€æ¬¡ã®åŸå› åˆ‡ã‚Šåˆ†ã‘ãŒæ¥½ã«ãªã‚Šã¾ã™ã€‚
        </div>
      </div>
    </div>
  </details>

  <div class="foot">
    <div class="badge">æ›´æ–°ãƒ¡ãƒ¢ï¼šã“ã®è³‡æ–™ã¯ã€Œã‚ãªãŸãŒå®Ÿéš›ã«è¸ã‚“ã  challenge_failed / not_in_channel / rate limitã€ã‚’å‰æã«ã€åˆ‡ã‚Šåˆ†ã‘ãŒé€Ÿããªã‚‹é †ã§æ§‹æˆã—ã¦ã„ã¾ã™ã€‚</div>
  </div>
</div>

<div class="toast" id="toast">ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ</div>

<script>
  // Theme toggle
  const btnTheme = document.getElementById('btnTheme');
  btnTheme.addEventListener('click', () => {
    const root = document.body;
    root.dataset.theme = root.dataset.theme === 'light' ? 'dark' : 'light';
    localStorage.setItem('slack-n8n-theme', root.dataset.theme);
  });
  (function restoreTheme(){
    const saved = localStorage.getItem('slack-n8n-theme');
    if(saved) document.body.dataset.theme = saved;
  })();

  // Open/Close all details
  const allDetails = () => Array.from(document.querySelectorAll('details.section'));
  document.getElementById('btnOpenAll').addEventListener('click', () => {
    allDetails().forEach(d => d.open = true);
  });
  document.getElementById('btnCloseAll').addEventListener('click', () => {
    allDetails().forEach(d => d.open = false);
    window.scrollTo({top:0, behavior:'smooth'});
  });

  // Open steps only (collapse others)
  document.getElementById('btnOpenSteps').addEventListener('click', () => {
    allDetails().forEach(d => {
      const kind = d.getAttribute('data-kind');
      d.open = (kind === 'steps');
    });
    const first = document.querySelector('details[data-kind="steps"]');
    if(first) first.scrollIntoView({behavior:'smooth', block:'start'});
  });

  // Copy buttons
  const toast = document.getElementById('toast');
  function showToast(msg){
    toast.textContent = msg || 'ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ';
    toast.style.display = 'block';
    clearTimeout(showToast._t);
    showToast._t = setTimeout(() => toast.style.display = 'none', 1400);
  }
  async function copyText(text){
    try{
      await navigator.clipboard.writeText(text);
      showToast('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
    }catch(e){
      // Fallback
      const ta = document.createElement('textarea');
      ta.value = text;
      ta.style.position='fixed';
      ta.style.left='-9999px';
      document.body.appendChild(ta);
      ta.select();
      document.execCommand('copy');
      ta.remove();
      showToast('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼ˆfallbackï¼‰');
    }
  }
  document.querySelectorAll('button.copy').forEach(btn => {
    btn.addEventListener('click', () => {
      const sel = btn.getAttribute('data-copy');
      const el = document.querySelector(sel);
      if(!el) return showToast('ã‚³ãƒ”ãƒ¼å¯¾è±¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      const text = el.innerText.replace(/\n+$/,'');
      copyText(text);
    });
  });
</script>
</body>
</html>

</body>
</html>