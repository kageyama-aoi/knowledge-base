# gsd 設定までの道のりまとめ

---

# 0. 今回やったことの全体像

あなたがやったのは：

> Git操作を短縮するために PowerShell を拡張した

具体的には：

```
gsd
```

という自作コマンドを作り、

```
git add .
git diff --staged
```

を一発実行できるようにした。

これは単なるショートカットではなく、

> シェル拡張の第一歩

です。

---

# 1. Gitの基礎整理（なぜ gsd が成立するのか）

## Gitの3層構造

```
① 作業フォルダ（今編集している状態）
② ステージ（次にコミットする候補）
③ 直前コミット（保存済み）
```

## git add の意味

```
git add .
```

→ 作業フォルダ → ステージ

「この変更を次のコミットに含めます」と宣言。

## git diff の種類

| コマンド | 比較対象 |
|----------|----------|
| git diff | 作業フォルダ vs ステージ |
| git diff --staged | ステージ vs 直前コミット |

今回使ったのは：

```
git diff --staged
```

理由：

> 今回コミット予定の変更だけを表示するため

---

# 2. BATではなくPowerShell関数を選んだ理由

## BATの特徴

- 外部スクリプト
- 別プロセス実行
- 文字列ベース処理
- 拡張性が低い

## PowerShell関数の特徴

- シェル内部に登録
- 同一セッションで実行
- オブジェクト処理可能
- 拡張しやすい

## 本質的な違い

BAT：

> 外から呼ぶ

PowerShell関数：

> 内部に組み込む

---

# 3. 技術背景（きちんと理解する）

## セッションとは

> 今開いているターミナルの実行空間

関数はこのセッション内に登録される。

---

## プロセスとは

> 実行中の独立したプログラム

BATは別プロセスを起動する。

---

## .NETランタイムとは

PowerShellは

> .NETランタイム上で動く

ランタイムとは：

> プログラムを動かす土台

.NETは：

- メモリ管理
- 型管理
- オブジェクト実行

を担当する実行基盤。

つまりPowerShellは単なる文字列シェルではない。

---

## オブジェクト指向とは

オブジェクトとは：

> データ＋振る舞いのセット

PowerShellのコマンド出力は

- 単なる文字列ではない
- 構造を持つデータ

これが

> オブジェクト指向ベース

という意味。

---

# 4. $PROFILE の理解

```
$PROFILE
```

これは：

> PowerShell起動時に自動実行される設定ファイル

ここに関数を書くことで：

- 永続化
- 自作コマンド化
- シェル拡張

が実現する。

---

# 5. プロファイルが複数ある問題

PowerShellには複数のプロファイルが存在する。

例：

- Microsoft.PowerShell_profile.ps1
- Microsoft.VSCode_profile.ps1

VS Codeでは

> VS Code専用プロファイル

が読み込まれる。

ここに書かないと反映されない。

---

# 6. 実行ポリシー問題

PowerShellはセキュリティのため

> スクリプト実行を制限

している場合がある。

確認：

```
Get-ExecutionPolicy
```

解決：

```
Set-ExecutionPolicy -Scope CurrentUser RemoteSigned
```

---

# 7. 文字コード問題

文字化けの原因は：

> エンコーディング不一致

PowerShell 5.x は

- UTF-8 with BOM
- UTF-16 LE

を期待する場合がある。

VS Codeのデフォルトは

- UTF-8（BOMなし）

→ 文字化け発生。

解決：

> UTF-8 with BOM で保存

---

# 8. 最終的な gsd 関数

```
function gsd {
    git add . | Out-Null

    $diff = git diff --staged

    if ([string]::IsNullOrWhiteSpace($diff)) {
        Write-Host "変更はありません。"
    } else {
        Write-Host "=== 今回コミット予定の変更 ==="
        Write-Host $diff
    }
}
```

---

# 9. 今回の学習で得た理解

あなたは以下を理解した：

- Gitの3層構造
- ステージの意味
- diffの役割
- セッションとプロセスの違い
- シェル拡張という概念
- プロファイルの役割
- 実行ポリシー
- 文字コード問題

これは

> 単なるショートカット作成ではない

シェル理解の一段上。

---

# 10. 次の拡張候補

ここから発展できること：

- gcm（commit message生成）
- gca（自動commit）
- 引数付き関数
- AI連携内蔵

---

# 総まとめ

今回あなたがやったことは：

> PowerShellを「使う側」から「拡張する側」に回った

ということ。

これは小さく見えて、かなり大きい一歩。

